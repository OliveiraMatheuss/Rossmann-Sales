

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Apresentação do Projeto &#8212; Rossmann Sales</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebook';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="api.rossmann.Rossmann" href="rossmann.html" />
    <link rel="prev" title="Readme" href="README.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/Rossmann.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/Rossmann.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="README.html">
                    Readme
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Apresentação</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Apresentação do Projeto</a></li>
















</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Documentação</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="rossmann.html">api.rossmann.Rossmann</a></li>

<li class="toctree-l1"><a class="reference internal" href="data_cleaning.html">Rosmann.data_cleaning</a></li>
<li class="toctree-l1"><a class="reference internal" href="feature_engineering.html">Rosmann.feature_engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_preparation.html">Rosmann.data_preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="get_prediction.html">Rossmann.get_prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="handler.html">api.handler.rossmann_predict</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contato</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://oliveiramatheuss.github.io/MatheusOliveiraPortifolio/">Portifólio de Projetos</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.linkedin.com/in/oliveiramatheuss/">LinkedIn</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/OliveiraMatheuss">GitHub</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/OliveiraMatheuss/Rossmann-Sales" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/OliveiraMatheuss/Rossmann-Sales/issues/new?title=Issue%20on%20page%20%2Fnotebook.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/notebook.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Apresentação do Projeto</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Apresentação do Projeto</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#bussines">1. Bussines</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contexto">1.1 Contexto</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#desafio">1.2 Desafio</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problema">Problema</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#causas">Causas</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">2. Configuration</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">2.1 Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">2.2 Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maquina">2.3 Máquina</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuracao-de-vizualizacao">2.4 Configuração de Vizualização</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-load">3. Data Load</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">3. Data Preprocessing</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rename-columns">3.1 Rename Columns</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-dimensions">3.2 Data Dimensions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-types">3.3 Data Types</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-na">3.4 Check NA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fillout-na">3.5 Fillout NA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#change-data-types">3.6 Change Data Types</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-description">4. Data Description</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-atributes">4.1 Numerical Atributes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-atributes">4.2. Categorical Atributes</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engeneering">5. Feature Engeneering</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mapa-mental-de-hipoteses">5.1 Mapa Mental de Hipoteses</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#criacao-das-hipoteses">5.2. Criaçao das Hipoteses</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hipoteses-loja">5.2.1. Hipoteses Loja</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hipoteses-produto">5.2.2. Hipoteses Produto</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hipoteses-tempo">5.2.3. Hipoteses Tempo</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lista-final-de-hipoteses">2.3. Lista Final de Hipóteses</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering">5.4. Feature Engineering</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#filtragem-das-variaveis">6. Filtragem das Variaveis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filtragem-das-linhas">6.1. Filtragem das Linhas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#selecao-das-colunas">6.2. Selecao das Colunas</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-data-analysis">7. Exploratory Data Analysis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-univariada">7.1. Analise Univariada</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variavel-target">7.1.1 Variavel Target</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variaveis-numerica">7.1.2 Variaveis Numérica</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variaveis-categoricas">7.1.2 Variaveis Categóricas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-bivariada">7.1. Analise Bivariada</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h1-lojas-com-maior-sortimentos-deveriam-na-media-vender-mais"><strong>H1.</strong> Lojas com maior sortimentos deveriam na média vender mais.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h2-lojas-com-competidores-mais-proximos-na-media-deveriam-vender-menos"><strong>H2.</strong> Lojas com competidores mais próximos na média deveriam vender menos.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h3-lojas-com-competidores-a-mais-tempo-deveriam-vender-mais"><strong>H3.</strong> Lojas com competidores à mais tempo deveriam vender mais.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h4-lojas-com-promocoes-ativas-por-mais-tempo-deveriam-vender-mais"><strong>H4.</strong> Lojas com promoções ativas por mais tempo deveriam vender mais.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h5-lojas-com-mais-promocoes-consecutivas-deveriam-vender-mais"><strong>H5.</strong> Lojas com mais promoções consecutivas deveriam vender mais.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h6-lojas-abertas-durante-o-feriado-de-natal-deveriam-vender-em-media-mais-que-os-demais-feriados"><strong>H6.</strong> Lojas abertas durante o feriado de Natal deveriam vender em média mais que os demais feriados.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h7-lojas-deveriam-vender-mais-ao-longo-dos-anos"><strong>H7.</strong> Lojas deveriam vender mais ao longo dos anos.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h8-lojas-deveriam-vender-mais-no-segundo-semestre-do-ano"><strong>H8.</strong> Lojas deveriam vender mais no segundo semestre do ano.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h10-lojas-deveriam-vender-mais-na-media-depois-do-dia-10-de-cada-mes"><strong>H10.</strong> Lojas deveriam vender mais na média depois do dia 10 de cada mês.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h11-lojas-deveriam-vender-menos-aos-finais-de-semana"><strong>H11.</strong> Lojas deveriam vender menos aos finais de semana.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h12-lojas-deveriam-vender-em-media-menos-durante-os-feriados-escolares"><strong>H12.</strong> Lojas deveriam vender em média menos durante os feriados escolares.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tabela-de-relevancia">Tabela de Relevância</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-multivariada">7.3. Analise Multivariada</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variaveis-numericas">7.3.1 Variaveis Numéricas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">7.3.2 Variaveis Categóricas</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">8. Data Preparation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rescaling">8.1 Rescaling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transformation">8.2 Transformation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#encoding">8.2.1 Encoding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#response-variable-transformation">8.2.2 Response Variable Transformation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nature-transformation">8.2.3 Nature Transformation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection">9. Feature Selection</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#split-dataframe-into-training-and-test-dataset">9.1 Split dataframe into training and test dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-as-feature-selector">9.2. RFE as Feature Selector</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-feature-selection">9.3 Manual Feature Selection</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#machine-learning-modeling">10. Machine Learning modeling</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#avarage-model">10.1 Avarage Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-model">10.2. Linear Regression Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-regularized-model-lasso">10.3. Linear Regression Regularized Model - Lasso</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest-regressor">10.4. Random Forest Regressor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost-regressor">10.5. XGBoost Regressor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gradient-boosting">10.6 Gradient Boosting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compare-model-s-performance">10.6 Compare Model’s Performance</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#hyperparameter-tuning">11. Hyperparameter Tuning</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#determinando-o-tamanho-da-amostra">11.1.1 Determinando o Tamanho da Amostra</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hyperparameter-tuning-com-bayesiansearchcv">11.1.2 Hyperparameter Tuning com BayesianSearchCV</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parametros">11.1.3 Parâmetros</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-final">11.3. Modelo Final</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#performance">12. Performance</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bussines-performance">12.1 Bussines Performance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#erro-percentual-medio-de-cada-loja">12.1.1 Erro percentual medio de cada loja</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distribuicao-e-analise-de-outiler-no-erro-do-modelo">12.1.2 Distribuição e Analise de Outiler no erro do modelo</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#total-performance">12.2 Total Performance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#machine-learning-performance">12.3 Machine Learning Performance</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#deploy">13. Deploy</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rossmann-class">13.1 Rossmann Class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#api-handler">13.2 API HANDLER</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#api-tester">13.3 API Tester</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusao">14. Conclusão</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#proximos-passos">15. Próximos Passos</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="s1">&#39;img/Rossmann.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6f42c811ed529a1c23563dbad19c7ad1003e2753fc965ea5ded2ec243f670b18.png" src="_images/6f42c811ed529a1c23563dbad19c7ad1003e2753fc965ea5ded2ec243f670b18.png" />
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="apresentacao-do-projeto">
<h1>Apresentação do Projeto<a class="headerlink" href="#apresentacao-do-projeto" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="bussines">
<h1>1. Bussines<a class="headerlink" href="#bussines" title="Permalink to this heading">#</a></h1>
<section id="contexto">
<h2>1.1 Contexto<a class="headerlink" href="#contexto" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Reunião Mensal de Resultados</p></li>
<li><p>CFO pediu uma Previsão de Vendas das Próximas 6 semanas de cada Loja</p></li>
</ul>
</section>
<section id="desafio">
<h2>1.2 Desafio<a class="headerlink" href="#desafio" title="Permalink to this heading">#</a></h2>
<section id="problema">
<h3>Problema<a class="headerlink" href="#problema" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Definição do Budget para a Reforma das Lojas.</p></li>
</ul>
</section>
<section id="causas">
<h3>Causas<a class="headerlink" href="#causas" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Predição de Vendas Atual apresentada muita Divergencia</p></li>
<li><p>O processo de Predição de Vendas é baseado em Experiencias Passadas.</p></li>
<li><p>Todo a Previsão de Vendas é feita Manualmente pelas 1.115 Lojas da Rossmann.</p></li>
<li><p>A visualização das Vendas é Limitada ao Computador.</p></li>
</ul>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="configuration">
<h1>2. Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading">#</a></h1>
<section id="imports">
<h2>2.1 Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">inflection</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="kn">import</span> <span class="nn">pandas</span>                   <span class="k">as</span>  <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span>                    <span class="k">as</span>  <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span>                  <span class="k">as</span>  <span class="nn">sns</span> 
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span>      <span class="k">as</span>  <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">xgboost</span>                  <span class="k">as</span>  <span class="nn">xgb</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span>       <span class="k">as</span> <span class="nn">patches</span>

<span class="kn">from</span> <span class="nn">flask</span>                      <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span> <span class="p">,</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">skopt</span>                      <span class="kn">import</span> <span class="n">BayesSearchCV</span>
<span class="kn">from</span> <span class="nn">matplotlib</span>                 <span class="kn">import</span>  <span class="n">pyplot</span>  <span class="k">as</span>  <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span>                      <span class="kn">import</span>  <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span>       <span class="kn">import</span>  <span class="n">HTML</span>
<span class="kn">from</span> <span class="nn">IPython.display</span>            <span class="kn">import</span>  <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">watermark</span>                  <span class="kn">import</span>  <span class="n">watermark</span>
<span class="kn">from</span> <span class="nn">sys</span>                        <span class="kn">import</span>  <span class="n">displayhook</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span>            <span class="kn">import</span>  <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_percentage_error</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span>  <span class="kn">import</span>  <span class="n">RFE</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span>      <span class="kn">import</span>  <span class="n">RobustScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">LabelEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span>           <span class="kn">import</span>  <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span>           <span class="kn">import</span>  <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span>       <span class="kn">import</span>  <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Lasso</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span>    <span class="kn">import</span>  <span class="n">TimeSeriesSplit</span><span class="p">,</span> <span class="n">GridSearchCV</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="functions">
<h2>2.2 Functions<a class="headerlink" href="#functions" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mean_percentage_erro</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">yhat</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">yhat</span><span class="p">)</span><span class="o">/</span><span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">timeSeries_CV</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">kfold</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">mae_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mape_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rmse_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tscv</span> <span class="o">=</span> <span class="n">TimeSeriesSplit</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span> <span class="n">kfold</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tscv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fold </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
                
                <span class="c1"># model</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span>  <span class="p">)</span>

                <span class="c1"># prediction</span>
                <span class="n">yhat</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">])</span>

                <span class="c1"># performance</span>
                <span class="n">m_result</span> <span class="o">=</span> <span class="n">ml_error</span><span class="p">(</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span> <span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span> <span class="n">yhat</span> <span class="p">)</span> <span class="p">)</span>

                <span class="c1"># store performance of each kfold iteration</span>
                <span class="n">mae_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">m_result</span><span class="p">[</span><span class="s1">&#39;MAE&#39;</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">mape_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">m_result</span><span class="p">[</span><span class="s1">&#39;MAPE&#39;</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">rmse_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">m_result</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">]</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;Model Name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
                                <span class="s1">&#39;MAE CV&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span> <span class="n">mae_list</span> <span class="p">),</span> <span class="mi">2</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">str</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; +/- &#39;</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span> <span class="n">mae_list</span> <span class="p">),</span> <span class="mi">2</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">str</span> <span class="p">),</span>
                                <span class="s1">&#39;MAPE CV&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span> <span class="n">mape_list</span> <span class="p">),</span> <span class="mi">2</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">str</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; +/- &#39;</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span> <span class="n">mape_list</span> <span class="p">),</span> <span class="mi">2</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">str</span> <span class="p">),</span>
                                <span class="s1">&#39;RMSE CV&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span> <span class="n">rmse_list</span> <span class="p">),</span> <span class="mi">2</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">str</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; +/- &#39;</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span> <span class="n">rmse_list</span> <span class="p">),</span> <span class="mi">2</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">str</span> <span class="p">)</span> <span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>


<span class="k">def</span> <span class="nf">ml_error</span><span class="p">(</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yhat</span> <span class="p">):</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span> <span class="n">y</span><span class="p">,</span> <span class="n">yhat</span> <span class="p">)</span>
    <span class="n">mape</span> <span class="o">=</span> <span class="n">mean_absolute_percentage_error</span><span class="p">(</span> <span class="n">y</span><span class="p">,</span> <span class="n">yhat</span> <span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">mean_squared_error</span><span class="p">(</span> <span class="n">y</span><span class="p">,</span> <span class="n">yhat</span> <span class="p">)</span> <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">{</span>  <span class="s1">&#39;Model Name&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span> 
                            <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="n">mae</span><span class="p">,</span> 
                            <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span>
                            <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span> <span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>

<span class="k">def</span> <span class="nf">cramer_v</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>  <span class="k">as</span> <span class="n">ss</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">shape</span>
        
        <span class="n">chi2</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span> <span class="n">cm</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">chi2corr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">chi2</span> <span class="o">-</span> <span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
        
        <span class="n">kcorr</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rcorr</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">chi2corr</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="nb">min</span><span class="p">(</span> <span class="n">kcorr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">rcorr</span><span class="o">-</span><span class="mi">1</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>


<span class="k">def</span> <span class="nf">jupyter_settings</span><span class="p">():</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span> <span class="s1">&#39;bmh&#39;</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">24</span>
    
    <span class="n">displayhook</span><span class="p">(</span> <span class="n">HTML</span><span class="p">(</span> <span class="s1">&#39;&lt;style&gt;.container { width:100% !important; }&lt;/style&gt;&#39;</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_columns</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span> <span class="s1">&#39;display.expand_frame_repr&#39;</span><span class="p">,</span> <span class="kc">False</span> <span class="p">)</span>
    
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
    
<span class="k">def</span> <span class="nf">summary_stats</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">index_target</span><span class="p">):</span>
    <span class="c1"># central tendency: mean, median   </span>
    <span class="n">numerical_features</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;number&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">numerical_features</span><span class="p">]</span>
    
    <span class="n">count_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
    <span class="n">sum_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">))</span>
    <span class="n">mean_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">))</span>
    <span class="n">std_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">))</span>
    <span class="n">median_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">))</span>
    
    <span class="n">min_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">min</span><span class="p">))</span>
    <span class="n">max_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">max</span><span class="p">))</span>
    <span class="n">range_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
    <span class="n">q1_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">25</span><span class="p">)))</span>
    <span class="n">q3_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">75</span><span class="p">)))</span>
    
    <span class="n">skewness_</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">skew</span><span class="p">()))</span>
    <span class="n">kurtosis_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">()))</span>
    
    <span class="n">summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">count_</span><span class="p">,</span> <span class="n">mean_</span><span class="p">,</span> <span class="n">std_</span><span class="p">,</span> <span class="n">median_</span><span class="p">,</span> <span class="n">sum_</span><span class="p">,</span> <span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">range_</span><span class="p">,</span> <span class="n">q1_</span><span class="p">,</span><span class="n">q3_</span><span class="p">,</span> <span class="n">skewness_</span><span class="p">,</span> <span class="n">kurtosis_</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">summary</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;std&#39;</span><span class="p">,</span><span class="s1">&#39;median&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="s1">&#39;25%&#39;</span><span class="p">,</span><span class="s1">&#39;75%&#39;</span><span class="p">,</span> <span class="s1">&#39;skew&#39;</span><span class="p">,</span> <span class="s1">&#39;kurt&#39;</span><span class="p">]</span>
 

    <span class="n">cm</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">light_palette</span><span class="p">(</span><span class="s2">&quot;#0e8d94&quot;</span><span class="p">,</span> <span class="n">as_cmap</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    
    <span class="n">display</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">index_target</span><span class="p">],</span><span class="n">summary</span><span class="o">.</span><span class="n">columns</span><span class="p">[:]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">))</span>
    
    
    

<span class="k">def</span> <span class="nf">dist_sales</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
        <span class="c1"># Cálculo da skewness e kurtosis</span>
        <span class="n">skewness</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">])</span>
        <span class="n">kurtosis</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">])</span>

        <span class="c1"># Texto para exibir as informações de skewness e kurtosis</span>
        <span class="n">info_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Skewness: </span><span class="si">{</span><span class="n">skewness</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">Kurtosis: </span><span class="si">{</span><span class="n">kurtosis</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>


        <span class="c1"># Criar a figura e os subplots</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

        <span class="c1"># Gráfico de densidade de probabilidade (KDE)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;KDE - Density Plot&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sales&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="n">info_text</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>

        <span class="c1"># Gráfico Q-Q (Quantile-Quantile)</span>
        <span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Q-Q Plot&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Theoretical Quantiles&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Sample Quantiles&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="n">info_text</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Para melhorar a aparência da figura</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="maquina">
<h2>2.3 Máquina<a class="headerlink" href="#maquina" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">watermark</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Last updated: 2023-08-28T21:13:29.953916-03:00

Python implementation: CPython
Python version       : 3.10.9
IPython version      : 8.13.2

Compiler    : MSC v.1934 64 bit (AMD64)
OS          : Windows
Release     : 10
Machine     : AMD64
Processor   : Intel64 Family 6 Model 142 Stepping 12, GenuineIntel
CPU cores   : 8
Architecture: 64bit
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">watermark</span><span class="p">(</span><span class="n">packages</span><span class="o">=</span><span class="s2">&quot;pandas,numpy,scikit-learn,xgboost,matplotlib,seaborn,scipy&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas      : 2.0.1
numpy       : 1.24.3
scikit-learn: 1.2.2
xgboost     : 1.7.5
matplotlib  : 3.7.1
seaborn     : 0.12.2
scipy       : 1.10.1
</pre></div>
</div>
</div>
</div>
</section>
<section id="configuracao-de-vizualizacao">
<h2>2.4 Configuração de Vizualização<a class="headerlink" href="#configuracao-de-vizualizacao" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configurações de Layout, Matlab e Seaborn</span>

<span class="n">LAYOUT_PALETTE</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#ef2b41&quot;</span><span class="p">,</span><span class="s2">&quot;#ee9b57&quot;</span><span class="p">,</span> <span class="s2">&quot;#11130e&quot;</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">LAYOUT_PALETTE</span><span class="p">))</span>

<span class="n">cm</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">light_palette</span><span class="p">(</span><span class="s2">&quot;#e76f51&quot;</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">palplot</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">LAYOUT_PALETTE</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a33d5aab0ac5166369265b4b11e0872db4f940c0ca4ff14e118a53a67a43b8d7.png" src="_images/a33d5aab0ac5166369265b4b11e0872db4f940c0ca4ff14e118a53a67a43b8d7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dimensionamendo do Dataframe</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-load">
<h1>3. Data Load<a class="headerlink" href="#data-load" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_sales_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/train.csv&#39;</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">df_store_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/store.csv&#39;</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">df_test_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/test.csv&#39;</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># União das tabelas Sales e Store</span>
<span class="n">df_train_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_sales_raw</span><span class="p">,</span> <span class="n">df_store_raw</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;Store&#39;</span><span class="p">)</span>
<span class="n">df_test_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_test_raw</span><span class="p">,</span> <span class="n">df_store_raw</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;Store&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_train_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">df_test_raw</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((1017209, 18), (41088, 17))
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-preprocessing">
<h1>3. Data Preprocessing<a class="headerlink" href="#data-preprocessing" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df3</span> <span class="o">=</span> <span class="n">df_train_raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
</pre></div>
</div>
</div>
</div>
<section id="rename-columns">
<h2>3.1 Rename Columns<a class="headerlink" href="#rename-columns" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols_old</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Store&#39;</span><span class="p">,</span> <span class="s1">&#39;DayOfWeek&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Sales&#39;</span><span class="p">,</span> <span class="s1">&#39;Customers&#39;</span><span class="p">,</span> <span class="s1">&#39;Open&#39;</span><span class="p">,</span> <span class="s1">&#39;Promo&#39;</span><span class="p">,</span>
        <span class="s1">&#39;StateHoliday&#39;</span><span class="p">,</span> <span class="s1">&#39;SchoolHoliday&#39;</span><span class="p">,</span> <span class="s1">&#39;StoreType&#39;</span><span class="p">,</span> <span class="s1">&#39;Assortment&#39;</span><span class="p">,</span>
        <span class="s1">&#39;CompetitionDistance&#39;</span><span class="p">,</span> <span class="s1">&#39;CompetitionOpenSinceMonth&#39;</span><span class="p">,</span>
        <span class="s1">&#39;CompetitionOpenSinceYear&#39;</span><span class="p">,</span> <span class="s1">&#39;Promo2&#39;</span><span class="p">,</span> <span class="s1">&#39;Promo2SinceWeek&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Promo2SinceYear&#39;</span><span class="p">,</span> <span class="s1">&#39;PromoInterval&#39;</span><span class="p">]</span>

<span class="n">snakecase</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">inflection</span><span class="o">.</span><span class="n">underscore</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">cols_new</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">snakecase</span><span class="p">,</span> <span class="n">cols_old</span><span class="p">))</span>

<span class="c1">#rename</span>

<span class="n">df3</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols_new</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-dimensions">
<h2>3.2 Data Dimensions<a class="headerlink" href="#data-dimensions" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of Rows: </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of Cols: </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of Rows: 1017209
Number of Cols: 18
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-types">
<h2>3.3 Data Types<a class="headerlink" href="#data-types" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df3</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df3</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="n">df3</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>store                                    int64
day_of_week                              int64
date                            datetime64[ns]
sales                                    int64
customers                                int64
open                                     int64
promo                                    int64
state_holiday                           object
school_holiday                           int64
store_type                              object
assortment                              object
competition_distance                   float64
competition_open_since_month           float64
competition_open_since_year            float64
promo2                                   int64
promo2_since_week                      float64
promo2_since_year                      float64
promo_interval                          object
dtype: object
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-na">
<h2>3.4 Check NA<a class="headerlink" href="#check-na" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df3</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>store                                0
day_of_week                          0
date                                 0
sales                                0
customers                            0
open                                 0
promo                                0
state_holiday                        0
school_holiday                       0
store_type                           0
assortment                           0
competition_distance              2642
competition_open_since_month    323348
competition_open_since_year     323348
promo2                               0
promo2_since_week               508031
promo2_since_year               508031
promo_interval                  508031
dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="fillout-na">
<h2>3.5 Fillout NA<a class="headerlink" href="#fillout-na" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df3</span><span class="p">[</span><span class="s1">&#39;promo_interval&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([nan, &#39;Jan,Apr,Jul,Oct&#39;, &#39;Feb,May,Aug,Nov&#39;, &#39;Mar,Jun,Sept,Dec&#39;],
      dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#competition_distance</span>
<span class="c1">#Adicionando uma distancia muito grander para as linhas onde o valor é nulo, aqui estou considerando que o competidor esta tão longe que não era possivel medir sua distancia</span>
<span class="c1"># ou não era significante</span>

<span class="n">df3</span><span class="p">[</span><span class="s1">&#39;competition_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[</span><span class="s1">&#39;competition_distance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">200000.0</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>

<span class="c1">#competition_open_since_month</span>
<span class="c1"># Considero os valores de mês para o inicio da concorrencia e que estejam nulo, começando no mês contido no resgitro da linha</span>

<span class="n">df3</span><span class="p">[</span><span class="s1">&#39;competition_open_since_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[[</span><span class="s1">&#39;competition_open_since_month&#39;</span> <span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">month</span> 
                                                <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;competition_open_since_month&#39;</span><span class="p">]</span> <span class="p">)</span> 
                                                <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;competition_open_since_month&#39;</span><span class="p">],</span>
                                                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>

<span class="c1">#competition_open_since_year     </span>
<span class="n">df3</span><span class="p">[</span><span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[[</span><span class="s1">&#39;competition_open_since_year&#39;</span> <span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">year</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>                       

<span class="c1">#promo2_since_week              </span>
<span class="n">df3</span><span class="p">[</span><span class="s1">&#39;promo2_since_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[[</span><span class="s1">&#39;promo2_since_week&#39;</span> <span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">week</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;promo2_since_week&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;promo2_since_week&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>

<span class="c1">#promo2_since_year               </span>
<span class="n">df3</span><span class="p">[</span><span class="s1">&#39;promo2_since_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[[</span><span class="s1">&#39;promo2_since_year&#39;</span> <span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">year</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;promo2_since_year&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="n">x</span> <span class="p">[</span><span class="s1">&#39;promo2_since_year&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">#promo_interval </span>
<span class="n">month_promo</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;Jan&#39;</span><span class="p">,</span>  <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;Fev&#39;</span><span class="p">,</span>  <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span>  <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span>  <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span>  <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span>  <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39;Jul&#39;</span><span class="p">,</span>  <span class="mi">8</span><span class="p">:</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span>  <span class="mi">9</span><span class="p">:</span> <span class="s1">&#39;Sept&#39;</span><span class="p">,</span>  <span class="mi">10</span><span class="p">:</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">:</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span> <span class="s1">&#39;Dec&#39;</span><span class="p">}</span>

<span class="n">df3</span><span class="p">[</span><span class="s1">&#39;promo_interval&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">df3</span><span class="p">[</span><span class="s1">&#39;month_promo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">month_promo</span><span class="p">)</span>
<span class="n">df3</span><span class="p">[</span><span class="s1">&#39;is_promo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[[</span><span class="s1">&#39;promo_interval&#39;</span><span class="p">,</span> <span class="s1">&#39;month_promo&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;promo_interval&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;month_promo&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;promo_interval&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">line</span> <span class="mi">19</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="n">df3</span><span class="p">[</span><span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[[</span><span class="s1">&#39;competition_open_since_year&#39;</span> <span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">year</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>                       
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="c1">#promo2_since_week              </span>
<span class="ne">---&gt; </span><span class="mi">19</span> <span class="n">df3</span><span class="p">[</span><span class="s1">&#39;promo2_since_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[[</span><span class="s1">&#39;promo2_since_week&#39;</span> <span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">week</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;promo2_since_week&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;promo2_since_week&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="c1">#promo2_since_year               </span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="n">df3</span><span class="p">[</span><span class="s1">&#39;promo2_since_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[[</span><span class="s1">&#39;promo2_since_year&#39;</span> <span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">year</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;promo2_since_year&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="n">x</span> <span class="p">[</span><span class="s1">&#39;promo2_since_year&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="nn">File ~\Documents\3.Repos\Rossmann-sales\.envRossmann\lib\site-packages\pandas\core\frame.py:9433,</span> in <span class="ni">DataFrame.apply</span><span class="nt">(self, func, axis, raw, result_type, args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">9422</span> <span class="kn">from</span> <span class="nn">pandas.core.apply</span> <span class="kn">import</span> <span class="n">frame_apply</span>
<span class="g g-Whitespace">   </span><span class="mi">9424</span> <span class="n">op</span> <span class="o">=</span> <span class="n">frame_apply</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">9425</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">9426</span>     <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">9431</span>     <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">9432</span> <span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">9433</span> <span class="k">return</span> <span class="n">op</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span><span class="o">.</span><span class="n">__finalize__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;apply&quot;</span><span class="p">)</span>

<span class="nn">File ~\Documents\3.Repos\Rossmann-sales\.envRossmann\lib\site-packages\pandas\core\apply.py:678,</span> in <span class="ni">FrameApply.apply</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">675</span> <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">676</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_raw</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">678</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_standard</span><span class="p">()</span>

<span class="nn">File ~\Documents\3.Repos\Rossmann-sales\.envRossmann\lib\site-packages\pandas\core\apply.py:798,</span> in <span class="ni">FrameApply.apply_standard</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">797</span> <span class="k">def</span> <span class="nf">apply_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">798</span>     <span class="n">results</span><span class="p">,</span> <span class="n">res_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_series_generator</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">800</span>     <span class="c1"># wrap results</span>
<span class="g g-Whitespace">    </span><span class="mi">801</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">res_index</span><span class="p">)</span>

<span class="nn">File ~\Documents\3.Repos\Rossmann-sales\.envRossmann\lib\site-packages\pandas\core\apply.py:815,</span> in <span class="ni">FrameApply.apply_series_generator</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span>     <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">series_gen</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">813</span>         <span class="c1"># ignore SettingWithCopy here in case the user mutates</span>
<span class="g g-Whitespace">    </span><span class="mi">814</span>         <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">815</span>         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ABCSeries</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">816</span>             <span class="c1"># If we have a view on v, we need to make a copy because</span>
<span class="g g-Whitespace">    </span><span class="mi">817</span>             <span class="c1">#  series_generator will swap out the underlying data</span>
<span class="g g-Whitespace">    </span><span class="mi">818</span>             <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">820</span> <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">res_index</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Checando os dados faltantes novamente</span>

<span class="n">df3</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>store                           0
day_of_week                     0
date                            0
sales                           0
customers                       0
open                            0
promo                           0
state_holiday                   0
school_holiday                  0
store_type                      0
assortment                      0
competition_distance            0
competition_open_since_month    0
competition_open_since_year     0
promo2                          0
promo2_since_week               0
promo2_since_year               0
promo_interval                  0
month_promo                     0
is_promo                        0
dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="change-data-types">
<h2>3.6 Change Data Types<a class="headerlink" href="#change-data-types" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># competiton</span>
<span class="n">df3</span><span class="p">[</span><span class="s1">&#39;competition_open_since_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[</span><span class="s1">&#39;competition_open_since_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">int</span> <span class="p">)</span>
<span class="n">df3</span><span class="p">[</span><span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[</span><span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">int</span> <span class="p">)</span>
    
<span class="c1"># promo2</span>
<span class="n">df3</span><span class="p">[</span><span class="s1">&#39;promo2_since_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[</span><span class="s1">&#39;promo2_since_week&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">int</span> <span class="p">)</span>
<span class="n">df3</span><span class="p">[</span><span class="s1">&#39;promo2_since_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[</span><span class="s1">&#39;promo2_since_year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">int</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-description">
<h1>4. Data Description<a class="headerlink" href="#data-description" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df4</span> <span class="o">=</span> <span class="n">df3</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_attributes</span> <span class="o">=</span> <span class="n">df4</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span><span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">])</span>
<span class="n">cat_atributes</span> <span class="o">=</span> <span class="n">df4</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<section id="numerical-atributes">
<h2>4.1 Numerical Atributes<a class="headerlink" href="#numerical-atributes" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">summary_stats</span><span class="p">(</span><span class="n">df4</span><span class="p">,</span> <span class="n">index_target</span><span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_ba322_row2_col0, #T_ba322_row2_col1, #T_ba322_row2_col2, #T_ba322_row2_col3, #T_ba322_row2_col4, #T_ba322_row2_col5, #T_ba322_row2_col6, #T_ba322_row2_col7, #T_ba322_row2_col8, #T_ba322_row2_col9, #T_ba322_row2_col10, #T_ba322_row2_col11 {
  background-color: #ebf2f3;
  color: #000000;
}
</style>
<table id="T_ba322">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_ba322_level0_col0" class="col_heading level0 col0" >counts</th>
      <th id="T_ba322_level0_col1" class="col_heading level0 col1" >mean</th>
      <th id="T_ba322_level0_col2" class="col_heading level0 col2" >std</th>
      <th id="T_ba322_level0_col3" class="col_heading level0 col3" >median</th>
      <th id="T_ba322_level0_col4" class="col_heading level0 col4" >sum</th>
      <th id="T_ba322_level0_col5" class="col_heading level0 col5" >min</th>
      <th id="T_ba322_level0_col6" class="col_heading level0 col6" >max</th>
      <th id="T_ba322_level0_col7" class="col_heading level0 col7" >range</th>
      <th id="T_ba322_level0_col8" class="col_heading level0 col8" >25%</th>
      <th id="T_ba322_level0_col9" class="col_heading level0 col9" >75%</th>
      <th id="T_ba322_level0_col10" class="col_heading level0 col10" >skew</th>
      <th id="T_ba322_level0_col11" class="col_heading level0 col11" >kurt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_ba322_level0_row0" class="row_heading level0 row0" >store</th>
      <td id="T_ba322_row0_col0" class="data row0 col0" >1017209.00</td>
      <td id="T_ba322_row0_col1" class="data row0 col1" >558.43</td>
      <td id="T_ba322_row0_col2" class="data row0 col2" >321.91</td>
      <td id="T_ba322_row0_col3" class="data row0 col3" >558.00</td>
      <td id="T_ba322_row0_col4" class="data row0 col4" >568039744.00</td>
      <td id="T_ba322_row0_col5" class="data row0 col5" >1.00</td>
      <td id="T_ba322_row0_col6" class="data row0 col6" >1115.00</td>
      <td id="T_ba322_row0_col7" class="data row0 col7" >1114.00</td>
      <td id="T_ba322_row0_col8" class="data row0 col8" >280.00</td>
      <td id="T_ba322_row0_col9" class="data row0 col9" >838.00</td>
      <td id="T_ba322_row0_col10" class="data row0 col10" >-0.00</td>
      <td id="T_ba322_row0_col11" class="data row0 col11" >-1.20</td>
    </tr>
    <tr>
      <th id="T_ba322_level0_row1" class="row_heading level0 row1" >day_of_week</th>
      <td id="T_ba322_row1_col0" class="data row1 col0" >1017209.00</td>
      <td id="T_ba322_row1_col1" class="data row1 col1" >4.00</td>
      <td id="T_ba322_row1_col2" class="data row1 col2" >2.00</td>
      <td id="T_ba322_row1_col3" class="data row1 col3" >4.00</td>
      <td id="T_ba322_row1_col4" class="data row1 col4" >4067148.00</td>
      <td id="T_ba322_row1_col5" class="data row1 col5" >1.00</td>
      <td id="T_ba322_row1_col6" class="data row1 col6" >7.00</td>
      <td id="T_ba322_row1_col7" class="data row1 col7" >6.00</td>
      <td id="T_ba322_row1_col8" class="data row1 col8" >2.00</td>
      <td id="T_ba322_row1_col9" class="data row1 col9" >6.00</td>
      <td id="T_ba322_row1_col10" class="data row1 col10" >0.00</td>
      <td id="T_ba322_row1_col11" class="data row1 col11" >-1.25</td>
    </tr>
    <tr>
      <th id="T_ba322_level0_row2" class="row_heading level0 row2" >sales</th>
      <td id="T_ba322_row2_col0" class="data row2 col0" >1017209.00</td>
      <td id="T_ba322_row2_col1" class="data row2 col1" >5773.82</td>
      <td id="T_ba322_row2_col2" class="data row2 col2" >3849.92</td>
      <td id="T_ba322_row2_col3" class="data row2 col3" >5744.00</td>
      <td id="T_ba322_row2_col4" class="data row2 col4" >5873180623.00</td>
      <td id="T_ba322_row2_col5" class="data row2 col5" >0.00</td>
      <td id="T_ba322_row2_col6" class="data row2 col6" >41551.00</td>
      <td id="T_ba322_row2_col7" class="data row2 col7" >41551.00</td>
      <td id="T_ba322_row2_col8" class="data row2 col8" >3727.00</td>
      <td id="T_ba322_row2_col9" class="data row2 col9" >7856.00</td>
      <td id="T_ba322_row2_col10" class="data row2 col10" >0.64</td>
      <td id="T_ba322_row2_col11" class="data row2 col11" >1.78</td>
    </tr>
    <tr>
      <th id="T_ba322_level0_row3" class="row_heading level0 row3" >customers</th>
      <td id="T_ba322_row3_col0" class="data row3 col0" >1017209.00</td>
      <td id="T_ba322_row3_col1" class="data row3 col1" >633.15</td>
      <td id="T_ba322_row3_col2" class="data row3 col2" >464.41</td>
      <td id="T_ba322_row3_col3" class="data row3 col3" >609.00</td>
      <td id="T_ba322_row3_col4" class="data row3 col4" >644041755.00</td>
      <td id="T_ba322_row3_col5" class="data row3 col5" >0.00</td>
      <td id="T_ba322_row3_col6" class="data row3 col6" >7388.00</td>
      <td id="T_ba322_row3_col7" class="data row3 col7" >7388.00</td>
      <td id="T_ba322_row3_col8" class="data row3 col8" >405.00</td>
      <td id="T_ba322_row3_col9" class="data row3 col9" >837.00</td>
      <td id="T_ba322_row3_col10" class="data row3 col10" >1.60</td>
      <td id="T_ba322_row3_col11" class="data row3 col11" >7.09</td>
    </tr>
    <tr>
      <th id="T_ba322_level0_row4" class="row_heading level0 row4" >open</th>
      <td id="T_ba322_row4_col0" class="data row4 col0" >1017209.00</td>
      <td id="T_ba322_row4_col1" class="data row4 col1" >0.83</td>
      <td id="T_ba322_row4_col2" class="data row4 col2" >0.38</td>
      <td id="T_ba322_row4_col3" class="data row4 col3" >1.00</td>
      <td id="T_ba322_row4_col4" class="data row4 col4" >844392.00</td>
      <td id="T_ba322_row4_col5" class="data row4 col5" >0.00</td>
      <td id="T_ba322_row4_col6" class="data row4 col6" >1.00</td>
      <td id="T_ba322_row4_col7" class="data row4 col7" >1.00</td>
      <td id="T_ba322_row4_col8" class="data row4 col8" >1.00</td>
      <td id="T_ba322_row4_col9" class="data row4 col9" >1.00</td>
      <td id="T_ba322_row4_col10" class="data row4 col10" >-1.76</td>
      <td id="T_ba322_row4_col11" class="data row4 col11" >1.09</td>
    </tr>
    <tr>
      <th id="T_ba322_level0_row5" class="row_heading level0 row5" >promo</th>
      <td id="T_ba322_row5_col0" class="data row5 col0" >1017209.00</td>
      <td id="T_ba322_row5_col1" class="data row5 col1" >0.38</td>
      <td id="T_ba322_row5_col2" class="data row5 col2" >0.49</td>
      <td id="T_ba322_row5_col3" class="data row5 col3" >0.00</td>
      <td id="T_ba322_row5_col4" class="data row5 col4" >388080.00</td>
      <td id="T_ba322_row5_col5" class="data row5 col5" >0.00</td>
      <td id="T_ba322_row5_col6" class="data row5 col6" >1.00</td>
      <td id="T_ba322_row5_col7" class="data row5 col7" >1.00</td>
      <td id="T_ba322_row5_col8" class="data row5 col8" >0.00</td>
      <td id="T_ba322_row5_col9" class="data row5 col9" >1.00</td>
      <td id="T_ba322_row5_col10" class="data row5 col10" >0.49</td>
      <td id="T_ba322_row5_col11" class="data row5 col11" >-1.76</td>
    </tr>
    <tr>
      <th id="T_ba322_level0_row6" class="row_heading level0 row6" >school_holiday</th>
      <td id="T_ba322_row6_col0" class="data row6 col0" >1017209.00</td>
      <td id="T_ba322_row6_col1" class="data row6 col1" >0.18</td>
      <td id="T_ba322_row6_col2" class="data row6 col2" >0.38</td>
      <td id="T_ba322_row6_col3" class="data row6 col3" >0.00</td>
      <td id="T_ba322_row6_col4" class="data row6 col4" >181721.00</td>
      <td id="T_ba322_row6_col5" class="data row6 col5" >0.00</td>
      <td id="T_ba322_row6_col6" class="data row6 col6" >1.00</td>
      <td id="T_ba322_row6_col7" class="data row6 col7" >1.00</td>
      <td id="T_ba322_row6_col8" class="data row6 col8" >0.00</td>
      <td id="T_ba322_row6_col9" class="data row6 col9" >0.00</td>
      <td id="T_ba322_row6_col10" class="data row6 col10" >1.68</td>
      <td id="T_ba322_row6_col11" class="data row6 col11" >0.82</td>
    </tr>
    <tr>
      <th id="T_ba322_level0_row7" class="row_heading level0 row7" >competition_distance</th>
      <td id="T_ba322_row7_col0" class="data row7 col0" >1017209.00</td>
      <td id="T_ba322_row7_col1" class="data row7 col1" >5935.44</td>
      <td id="T_ba322_row7_col2" class="data row7 col2" >12547.65</td>
      <td id="T_ba322_row7_col3" class="data row7 col3" >2330.00</td>
      <td id="T_ba322_row7_col4" class="data row7 col4" >6037585710.00</td>
      <td id="T_ba322_row7_col5" class="data row7 col5" >20.00</td>
      <td id="T_ba322_row7_col6" class="data row7 col6" >200000.00</td>
      <td id="T_ba322_row7_col7" class="data row7 col7" >199980.00</td>
      <td id="T_ba322_row7_col8" class="data row7 col8" >710.00</td>
      <td id="T_ba322_row7_col9" class="data row7 col9" >6910.00</td>
      <td id="T_ba322_row7_col10" class="data row7 col10" >10.24</td>
      <td id="T_ba322_row7_col11" class="data row7 col11" >147.79</td>
    </tr>
    <tr>
      <th id="T_ba322_level0_row8" class="row_heading level0 row8" >competition_open_since_month</th>
      <td id="T_ba322_row8_col0" class="data row8 col0" >1017209.00</td>
      <td id="T_ba322_row8_col1" class="data row8 col1" >6.79</td>
      <td id="T_ba322_row8_col2" class="data row8 col2" >3.31</td>
      <td id="T_ba322_row8_col3" class="data row8 col3" >7.00</td>
      <td id="T_ba322_row8_col4" class="data row8 col4" >6903644.00</td>
      <td id="T_ba322_row8_col5" class="data row8 col5" >1.00</td>
      <td id="T_ba322_row8_col6" class="data row8 col6" >12.00</td>
      <td id="T_ba322_row8_col7" class="data row8 col7" >11.00</td>
      <td id="T_ba322_row8_col8" class="data row8 col8" >4.00</td>
      <td id="T_ba322_row8_col9" class="data row8 col9" >10.00</td>
      <td id="T_ba322_row8_col10" class="data row8 col10" >-0.04</td>
      <td id="T_ba322_row8_col11" class="data row8 col11" >-1.23</td>
    </tr>
    <tr>
      <th id="T_ba322_level0_row9" class="row_heading level0 row9" >competition_open_since_year</th>
      <td id="T_ba322_row9_col0" class="data row9 col0" >1017209.00</td>
      <td id="T_ba322_row9_col1" class="data row9 col1" >2010.32</td>
      <td id="T_ba322_row9_col2" class="data row9 col2" >5.52</td>
      <td id="T_ba322_row9_col3" class="data row9 col3" >2012.00</td>
      <td id="T_ba322_row9_col4" class="data row9 col4" >2044920520.00</td>
      <td id="T_ba322_row9_col5" class="data row9 col5" >1900.00</td>
      <td id="T_ba322_row9_col6" class="data row9 col6" >2015.00</td>
      <td id="T_ba322_row9_col7" class="data row9 col7" >115.00</td>
      <td id="T_ba322_row9_col8" class="data row9 col8" >2008.00</td>
      <td id="T_ba322_row9_col9" class="data row9 col9" >2014.00</td>
      <td id="T_ba322_row9_col10" class="data row9 col10" >-7.24</td>
      <td id="T_ba322_row9_col11" class="data row9 col11" >124.07</td>
    </tr>
    <tr>
      <th id="T_ba322_level0_row10" class="row_heading level0 row10" >promo2</th>
      <td id="T_ba322_row10_col0" class="data row10 col0" >1017209.00</td>
      <td id="T_ba322_row10_col1" class="data row10 col1" >0.50</td>
      <td id="T_ba322_row10_col2" class="data row10 col2" >0.50</td>
      <td id="T_ba322_row10_col3" class="data row10 col3" >1.00</td>
      <td id="T_ba322_row10_col4" class="data row10 col4" >509178.00</td>
      <td id="T_ba322_row10_col5" class="data row10 col5" >0.00</td>
      <td id="T_ba322_row10_col6" class="data row10 col6" >1.00</td>
      <td id="T_ba322_row10_col7" class="data row10 col7" >1.00</td>
      <td id="T_ba322_row10_col8" class="data row10 col8" >0.00</td>
      <td id="T_ba322_row10_col9" class="data row10 col9" >1.00</td>
      <td id="T_ba322_row10_col10" class="data row10 col10" >-0.00</td>
      <td id="T_ba322_row10_col11" class="data row10 col11" >-2.00</td>
    </tr>
    <tr>
      <th id="T_ba322_level0_row11" class="row_heading level0 row11" >promo2_since_week</th>
      <td id="T_ba322_row11_col0" class="data row11 col0" >1017209.00</td>
      <td id="T_ba322_row11_col1" class="data row11 col1" >23.62</td>
      <td id="T_ba322_row11_col2" class="data row11 col2" >14.31</td>
      <td id="T_ba322_row11_col3" class="data row11 col3" >22.00</td>
      <td id="T_ba322_row11_col4" class="data row11 col4" >24025493.00</td>
      <td id="T_ba322_row11_col5" class="data row11 col5" >1.00</td>
      <td id="T_ba322_row11_col6" class="data row11 col6" >52.00</td>
      <td id="T_ba322_row11_col7" class="data row11 col7" >51.00</td>
      <td id="T_ba322_row11_col8" class="data row11 col8" >12.00</td>
      <td id="T_ba322_row11_col9" class="data row11 col9" >37.00</td>
      <td id="T_ba322_row11_col10" class="data row11 col10" >0.18</td>
      <td id="T_ba322_row11_col11" class="data row11 col11" >-1.18</td>
    </tr>
    <tr>
      <th id="T_ba322_level0_row12" class="row_heading level0 row12" >promo2_since_year</th>
      <td id="T_ba322_row12_col0" class="data row12 col0" >1017209.00</td>
      <td id="T_ba322_row12_col1" class="data row12 col1" >2012.79</td>
      <td id="T_ba322_row12_col2" class="data row12 col2" >1.66</td>
      <td id="T_ba322_row12_col3" class="data row12 col3" >2013.00</td>
      <td id="T_ba322_row12_col4" class="data row12 col4" >2047431457.00</td>
      <td id="T_ba322_row12_col5" class="data row12 col5" >2009.00</td>
      <td id="T_ba322_row12_col6" class="data row12 col6" >2015.00</td>
      <td id="T_ba322_row12_col7" class="data row12 col7" >6.00</td>
      <td id="T_ba322_row12_col8" class="data row12 col8" >2012.00</td>
      <td id="T_ba322_row12_col9" class="data row12 col9" >2014.00</td>
      <td id="T_ba322_row12_col10" class="data row12 col10" >-0.78</td>
      <td id="T_ba322_row12_col11" class="data row12 col11" >-0.21</td>
    </tr>
    <tr>
      <th id="T_ba322_level0_row13" class="row_heading level0 row13" >is_promo</th>
      <td id="T_ba322_row13_col0" class="data row13 col0" >1017209.00</td>
      <td id="T_ba322_row13_col1" class="data row13 col1" >0.16</td>
      <td id="T_ba322_row13_col2" class="data row13 col2" >0.37</td>
      <td id="T_ba322_row13_col3" class="data row13 col3" >0.00</td>
      <td id="T_ba322_row13_col4" class="data row13 col4" >163872.00</td>
      <td id="T_ba322_row13_col5" class="data row13 col5" >0.00</td>
      <td id="T_ba322_row13_col6" class="data row13 col6" >1.00</td>
      <td id="T_ba322_row13_col7" class="data row13 col7" >1.00</td>
      <td id="T_ba322_row13_col8" class="data row13 col8" >0.00</td>
      <td id="T_ba322_row13_col9" class="data row13 col9" >0.00</td>
      <td id="T_ba322_row13_col10" class="data row13 col10" >1.84</td>
      <td id="T_ba322_row13_col11" class="data row13 col11" >1.40</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="categorical-atributes">
<h2>4.2. Categorical Atributes<a class="headerlink" href="#categorical-atributes" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aux</span> <span class="o">=</span> <span class="n">df4</span><span class="p">[(</span><span class="n">df4</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df4</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;store_type&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;assortment&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/52c6e0c64b7d367ec96555311e522d7f336b49fb9a88c1f97442473ee0df8608.png" src="_images/52c6e0c64b7d367ec96555311e522d7f336b49fb9a88c1f97442473ee0df8608.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="feature-engeneering">
<h1>5. Feature Engeneering<a class="headerlink" href="#feature-engeneering" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df5</span> <span class="o">=</span> <span class="n">df4</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="mapa-mental-de-hipoteses">
<h2>5.1 Mapa Mental de Hipoteses<a class="headerlink" href="#mapa-mental-de-hipoteses" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="p">(</span><span class="s1">&#39;img/mindmap.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/217feea0de93204df21d76c3d3f7b645348e46a267fa3ab33de2ce0bc659eb0f.png" src="_images/217feea0de93204df21d76c3d3f7b645348e46a267fa3ab33de2ce0bc659eb0f.png" />
</div>
</div>
</section>
<section id="criacao-das-hipoteses">
<h2>5.2. Criaçao das Hipoteses<a class="headerlink" href="#criacao-das-hipoteses" title="Permalink to this heading">#</a></h2>
<section id="hipoteses-loja">
<h3>5.2.1. Hipoteses Loja<a class="headerlink" href="#hipoteses-loja" title="Permalink to this heading">#</a></h3>
<p><strong>1.</strong> Lojas com número maior de funcionários deveriam vender mais.</p>
<p><strong>2.</strong> Lojas com maior capacidade de estoque deveriam vender mais.</p>
<p><strong>3.</strong> Lojas com maior porte deveriam vender mais.</p>
<p><strong>4.</strong> Lojas com maior sortimentos deveriam vender mais.</p>
<p><strong>5.</strong> Lojas com competidores mais próximos deveriam vender menos.</p>
<p><strong>6.</strong> Lojas com competidores à mais tempo deveriam vendem mais.</p>
</section>
<section id="hipoteses-produto">
<h3>5.2.2. Hipoteses Produto<a class="headerlink" href="#hipoteses-produto" title="Permalink to this heading">#</a></h3>
<p><strong>1.</strong> Lojas que investem mais em Marketing deveriam vender mais.</p>
<p><strong>2.</strong> Lojas com maior exposição de produto deveriam vender mais.</p>
<p><strong>3.</strong> Lojas com produtos com preço menor deveriam vender mais.</p>
<p><strong>4.</strong> Lojas com promoções mais agressivas ( descontos maiores ), deveriam vender mais.</p>
<p><strong>5.</strong> Lojas com promoções ativas por mais tempo deveriam vender mais.</p>
<p><strong>6.</strong> Lojas com mais dias de promoção deveriam vender mais.</p>
<p><strong>7.</strong> Lojas com mais promoções consecutivas deveriam vender mais.</p>
</section>
<section id="hipoteses-tempo">
<h3>5.2.3. Hipoteses Tempo<a class="headerlink" href="#hipoteses-tempo" title="Permalink to this heading">#</a></h3>
<p><strong>1.</strong> Lojas abertas durante o feriado de Natal deveriam vender mais.</p>
<p><strong>2.</strong> Lojas deveriam vender mais ao longo dos anos.</p>
<p><strong>3.</strong> Lojas deveriam vender mais no segundo semestre do ano.</p>
<p><strong>4.</strong> Lojas deveriam vender mais depois do dia 10 de cada mês.</p>
<p><strong>5.</strong> Lojas deveriam vender menos aos finais de semana.</p>
<p><strong>6.</strong> Lojas deveriam vender menos durante os feriados escolares.</p>
</section>
</section>
<section id="lista-final-de-hipoteses">
<h2>2.3. Lista Final de Hipóteses<a class="headerlink" href="#lista-final-de-hipoteses" title="Permalink to this heading">#</a></h2>
<p><strong>1.</strong> Lojas com maior sortimentos deveriam vender mais.</p>
<p><strong>2.</strong> Lojas com competidores mais próximos deveriam vender menos.</p>
<p><strong>3.</strong> Lojas com competidores à mais tempo deveriam vendem mais.</p>
<p><strong>4.</strong> Lojas com promoções ativas por mais tempo deveriam vender mais.</p>
<p><strong>5.</strong> Lojas com mais dias de promoção deveriam vender mais.</p>
<p><strong>6.</strong> Lojas com mais promoções consecutivas deveriam vender mais.</p>
<p><strong>7.</strong> Lojas abertas durante o feriado de Natal deveriam vender mais.</p>
<p><strong>8.</strong> Lojas deveriam vender mais ao longo dos anos.</p>
<p><strong>9.</strong> Lojas deveriam vender mais no segundo semestre do ano.</p>
<p><strong>10.</strong> Lojas deveriam vender mais depois do dia 10 de cada mês.</p>
<p><strong>11.</strong> Lojas deveriam vender menos aos finais de semana.</p>
<p><strong>12.</strong> Lojas deveriam vender menos durante os feriados escolares.</p>
</section>
<section id="feature-engineering">
<h2>5.4. Feature Engineering<a class="headerlink" href="#feature-engineering" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df5</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>store                                    int64
day_of_week                              int64
date                            datetime64[ns]
sales                                    int64
customers                                int64
open                                     int64
promo                                    int64
state_holiday                           object
school_holiday                           int64
store_type                              object
assortment                              object
competition_distance                   float64
competition_open_since_month             int32
competition_open_since_year              int32
promo2                                   int64
promo2_since_week                        int32
promo2_since_year                        int32
promo_interval                          object
month_promo                             object
is_promo                                 int64
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Para validar as hipoteses levantadas eu preciso de criar novas colunas em meu dataset</span>

<span class="c1"># year</span>
<span class="n">df5</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df5</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>

<span class="c1"># month</span>
<span class="n">df5</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df5</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>

<span class="c1"># day</span>
<span class="n">df5</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df5</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>

<span class="c1"># week of year</span>
<span class="n">df5</span><span class="p">[</span><span class="s1">&#39;week_of_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df5</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()</span><span class="o">.</span><span class="n">week</span>

<span class="c1"># year week</span>
<span class="n">df5</span><span class="p">[</span><span class="s1">&#39;year_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df5</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span> <span class="s1">&#39;%Y-%W&#39;</span> <span class="p">)</span>

<span class="c1"># competition since</span>
<span class="n">df5</span><span class="p">[</span><span class="s1">&#39;competition_since&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df5</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span> <span class="n">year</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">],</span> <span class="n">month</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;competition_open_since_month&#39;</span><span class="p">],</span><span class="n">day</span><span class="o">=</span><span class="mi">1</span> <span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
<span class="n">df5</span><span class="p">[</span><span class="s1">&#39;competition_time_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df5</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df5</span><span class="p">[</span><span class="s1">&#39;competition_since&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">days</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">days</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># promo since</span>
<span class="n">df5</span><span class="p">[</span><span class="s1">&#39;promo_since&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df5</span><span class="p">[</span><span class="s1">&#39;promo2_since_year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">str</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">df5</span><span class="p">[</span><span class="s1">&#39;promo2_since_week&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">str</span> <span class="p">)</span>
<span class="n">df5</span><span class="p">[</span><span class="s1">&#39;promo_since&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df5</span><span class="p">[</span><span class="s1">&#39;promo_since&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;-1&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y-%W-%w&#39;</span> <span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span> <span class="n">days</span><span class="o">=</span><span class="mi">7</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">df5</span><span class="p">[</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span> <span class="n">df5</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df5</span><span class="p">[</span><span class="s1">&#39;promo_since&#39;</span><span class="p">]</span> <span class="p">)</span><span class="o">/</span><span class="mi">7</span> <span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">days</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">int</span> <span class="p">)</span>

<span class="c1"># assortment</span>
<span class="n">df5</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df5</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;basic&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span> <span class="k">else</span> <span class="s1">&#39;extra&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span> <span class="k">else</span> <span class="s1">&#39;extended&#39;</span> <span class="p">)</span>

<span class="c1"># state holiday</span>
<span class="n">df5</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df5</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;public_holiday&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span> <span class="k">else</span> <span class="s1">&#39;easter_holiday&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span> <span class="k">else</span> <span class="s1">&#39;christmas&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span> <span class="k">else</span> <span class="s1">&#39;regular_day&#39;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="filtragem-das-variaveis">
<h1>6. Filtragem das Variaveis<a class="headerlink" href="#filtragem-das-variaveis" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df6</span> <span class="o">=</span> <span class="n">df5</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="filtragem-das-linhas">
<h2>6.1. Filtragem das Linhas<a class="headerlink" href="#filtragem-das-linhas" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Quero apenas dados onde a loja esta aberta e que valor de vendas seja maior que 0</span>
<span class="n">df6</span> <span class="o">=</span> <span class="n">df6</span><span class="p">[(</span><span class="n">df6</span><span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df6</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="selecao-das-colunas">
<h2>6.2. Selecao das Colunas<a class="headerlink" href="#selecao-das-colunas" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Excluir colunas na qual eu não terei durante o processo de previsão</span>
<span class="n">cols_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;customers&#39;</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;promo_interval&#39;</span><span class="p">,</span> <span class="s1">&#39;month_promo&#39;</span><span class="p">]</span>
<span class="n">df6</span> <span class="o">=</span> <span class="n">df6</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span> <span class="n">cols_drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="exploratory-data-analysis">
<h1>7. Exploratory Data Analysis<a class="headerlink" href="#exploratory-data-analysis" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df7</span> <span class="o">=</span> <span class="n">df6</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="analise-univariada">
<h2>7.1. Analise Univariada<a class="headerlink" href="#analise-univariada" title="Permalink to this heading">#</a></h2>
<section id="variavel-target">
<h3>7.1.1 Variavel Target<a class="headerlink" href="#variavel-target" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Podemos ver que nossa varável target não é uma distribuição normal</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Distribuição da variavel target</span>
<span class="n">dist_sales</span><span class="p">(</span><span class="n">df7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f93d9ce25feb17fbf1cdc6333b76670acdbd269aad3cfb289d29632ab6ed1070.png" src="_images/f93d9ce25feb17fbf1cdc6333b76670acdbd269aad3cfb289d29632ab6ed1070.png" />
</div>
</div>
</section>
<section id="variaveis-numerica">
<h3>7.1.2 Variaveis Numérica<a class="headerlink" href="#variaveis-numerica" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df7</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>store                                    int64
day_of_week                              int64
date                            datetime64[ns]
sales                                    int64
promo                                    int64
state_holiday                           object
school_holiday                           int64
store_type                              object
assortment                              object
competition_distance                   float64
competition_open_since_month             int32
competition_open_since_year              int32
promo2                                   int64
promo2_since_week                        int32
promo2_since_year                        int32
is_promo                                 int64
year                                     int32
month                                    int32
day                                      int32
week_of_year                            UInt32
year_week                               object
competition_since               datetime64[ns]
competition_time_month                   int32
promo_since                     datetime64[ns]
promo_time_week                          int32
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_atributes</span> <span class="o">=</span> <span class="n">df7</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;int32&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">])</span>


<span class="n">num_atributes</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/26c6e047618509a1bc92da8a3cc6c3d2f8555361ae48903064ee92efef9e86af.png" src="_images/26c6e047618509a1bc92da8a3cc6c3d2f8555361ae48903064ee92efef9e86af.png" />
</div>
</div>
</section>
<section id="variaveis-categoricas">
<h3>7.1.2 Variaveis Categóricas<a class="headerlink" href="#variaveis-categoricas" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># state_holiday</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">df7</span><span class="p">[</span><span class="n">df7</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;regular_day&#39;</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span> <span class="n">df7</span><span class="p">[</span><span class="n">df7</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;public_holiday&#39;</span><span class="p">][</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;public_holiday&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span> <span class="n">df7</span><span class="p">[</span><span class="n">df7</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;easter_holiday&#39;</span><span class="p">][</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;easter_holiday&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span> <span class="n">df7</span><span class="p">[</span><span class="n">df7</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;christmas&#39;</span><span class="p">][</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;christmas&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1"># store_type</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span>  <span class="n">df7</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;store_type&#39;</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span> <span class="n">df7</span><span class="p">[</span><span class="n">df7</span><span class="p">[</span><span class="s1">&#39;store_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span> <span class="n">df7</span><span class="p">[</span><span class="n">df7</span><span class="p">[</span><span class="s1">&#39;store_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span> <span class="n">df7</span><span class="p">[</span><span class="n">df7</span><span class="p">[</span><span class="s1">&#39;store_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span> <span class="n">df7</span><span class="p">[</span><span class="n">df7</span><span class="p">[</span><span class="s1">&#39;store_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1"># assortment</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df7</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;assortment&#39;</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span> <span class="n">df7</span><span class="p">[</span><span class="n">df7</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;extended&#39;</span><span class="p">][</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;extended&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span> <span class="n">df7</span><span class="p">[</span><span class="n">df7</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;basic&#39;</span><span class="p">][</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;basic&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span> <span class="n">df7</span><span class="p">[</span><span class="n">df7</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;extra&#39;</span><span class="p">][</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;extra&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1a8b791295f8e0a8dde37b5fb4e545849eb40efcb884fba182cf3407cc3334ef.png" src="_images/1a8b791295f8e0a8dde37b5fb4e545849eb40efcb884fba182cf3407cc3334ef.png" />
</div>
</div>
</section>
</section>
<section id="analise-bivariada">
<h2>7.1. Analise Bivariada<a class="headerlink" href="#analise-bivariada" title="Permalink to this heading">#</a></h2>
<section id="h1-lojas-com-maior-sortimentos-deveriam-na-media-vender-mais">
<h3><strong>H1.</strong> Lojas com maior sortimentos deveriam na média vender mais.<a class="headerlink" href="#h1-lojas-com-maior-sortimentos-deveriam-na-media-vender-mais" title="Permalink to this heading">#</a></h3>
<p><strong>Verdadeira</strong> Lojas com MAIOR SORTIMENTO na média vendem MAIS.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#dados</span>
<span class="n">aux1</span> <span class="o">=</span> <span class="n">df7</span><span class="p">[[</span><span class="s1">&#39;assortment&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;assortment&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">aux2</span> <span class="o">=</span> <span class="n">df7</span><span class="p">[[</span><span class="s1">&#39;year_week&#39;</span><span class="p">,</span> <span class="s1">&#39;assortment&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;year_week&#39;</span><span class="p">,</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">aux3</span> <span class="o">=</span> <span class="n">aux2</span><span class="p">[</span><span class="n">aux2</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;extra&#39;</span><span class="p">]</span>
<span class="n">aux2</span> <span class="o">=</span> <span class="n">aux2</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;year_week&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;assortment&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span> <span class="p">)</span>
<span class="n">aux3</span>  <span class="o">=</span> <span class="n">aux3</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;year_week&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;assortment&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span> <span class="p">)</span>

<span class="n">eixo_x</span> <span class="o">=</span> <span class="n">df7</span><span class="p">[</span><span class="s1">&#39;year_week&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;assortment&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux1</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">aux2</span><span class="p">,</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">eixo_x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">eixo_x</span><span class="p">):</span><span class="mi">10</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">aux3</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">aux3</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">aux3</span><span class="o">.</span><span class="n">extra</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">eixo_x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">eixo_x</span><span class="p">):</span><span class="mi">10</span><span class="p">])</span>

<span class="c1"># Rotacionar os valores do eixo x em 45 graus</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3d3f18af26fda67f0e809e571742f98514e6dc738082ca1a1282e391b75bf42d.png" src="_images/3d3f18af26fda67f0e809e571742f98514e6dc738082ca1a1282e391b75bf42d.png" />
</div>
</div>
</section>
<section id="h2-lojas-com-competidores-mais-proximos-na-media-deveriam-vender-menos">
<h3><strong>H2.</strong> Lojas com competidores mais próximos na média deveriam vender menos.<a class="headerlink" href="#h2-lojas-com-competidores-mais-proximos-na-media-deveriam-vender-menos" title="Permalink to this heading">#</a></h3>
<p><strong>FALSA</strong> Lojas com COMPETIDORES MAIS PROXIMOS em média vendem MAIS.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aux1</span> <span class="o">=</span> <span class="n">df4</span><span class="p">[[</span><span class="s1">&#39;competition_distance&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;competition_distance&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="c1"># Converter colunas com Interval para strings</span>
<span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;competition_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;competition_distance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># Plotar o heatmap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span> <span class="n">x</span> <span class="o">=</span><span class="s1">&#39;competition_distance&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux1</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
<span class="n">bins</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span> <span class="p">)</span>
<span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;competition_distance_binned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span> <span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;competition_distance&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span> <span class="p">)</span>
<span class="n">aux2</span> <span class="o">=</span> <span class="n">aux1</span><span class="p">[[</span><span class="s1">&#39;competition_distance_binned&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;competition_distance_binned&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;competition_distance_binned&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux2</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span> <span class="n">aux1</span><span class="p">[[</span><span class="s1">&#39;competition_distance&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">bottom</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span> <span class="n">bottom</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">top</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2.5, -0.5)
</pre></div>
</div>
<img alt="_images/86f5f16b601a01b1d3861c55e9a2dce8733846a28676bbe9af199f4f90bcc8a0.png" src="_images/86f5f16b601a01b1d3861c55e9a2dce8733846a28676bbe9af199f4f90bcc8a0.png" />
</div>
</div>
</section>
<section id="h3-lojas-com-competidores-a-mais-tempo-deveriam-vender-mais">
<h3><strong>H3.</strong> Lojas com competidores à mais tempo deveriam vender mais.<a class="headerlink" href="#h3-lojas-com-competidores-a-mais-tempo-deveriam-vender-mais" title="Permalink to this heading">#</a></h3>
<p><strong>FALSE</strong> Lojas com COMPETIDORES À MAIS TEMPO vendem MENOS.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="c1">#Grafico 1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="n">aux1</span> <span class="o">=</span> <span class="n">df7</span><span class="p">[[</span><span class="s1">&#39;competition_time_month&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;competition_time_month&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">aux2</span> <span class="o">=</span> <span class="n">aux1</span><span class="p">[(</span> <span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;competition_time_month&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">120</span> <span class="p">)]</span>

<span class="c1"># Barplot</span>

    <span class="c1"># Definir o número de intervalos</span>
<span class="n">num_intervals</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="c1"># Criar os intervalos para agrupamento</span>
<span class="n">intervalos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">aux2</span><span class="p">[</span><span class="s1">&#39;competition_time_month&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">num_intervals</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Agrupar os dados por intervalo e calcular a média das vendas</span>

<span class="n">dados_agrupados</span> <span class="o">=</span> <span class="n">aux2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">intervalos</span><span class="p">)[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;competition_time_month&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dados_agrupados</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">)</span>




<span class="c1">#Grafico 2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

<span class="c1"># Regressão entre sales e competition_time_month</span>

<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;competition_time_month&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux2</span> <span class="p">)</span>

    <span class="c1"># Índice do ponto ao qual você deseja adicionar a anotação</span>
<span class="n">ponto_anotacao</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Coordenadas do ponto e do texto da anotação</span>
<span class="n">x_ponto</span> <span class="o">=</span> <span class="n">aux2</span><span class="p">[</span><span class="s1">&#39;competition_time_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ponto_anotacao</span><span class="p">]</span>
<span class="n">y_ponto</span> <span class="o">=</span> <span class="n">aux2</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ponto_anotacao</span><span class="p">]</span>
<span class="n">texto_anotacao</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Outlier&#39;</span>

    <span class="c1"># Adicionar a anotação com uma seta e um texto</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">texto_anotacao</span><span class="p">,</span> <span class="p">(</span><span class="n">x_ponto</span><span class="p">,</span> <span class="n">y_ponto</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x_ponto</span> <span class="o">+</span> <span class="mi">50</span><span class="p">,</span> <span class="n">y_ponto</span> <span class="o">-</span> <span class="mi">20000000</span><span class="p">),</span>
             <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">))</span>



<span class="c1"># Grafico 3</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span> <span class="n">aux2</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">bottom</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span> <span class="n">bottom</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">top</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2.5, -0.5)
</pre></div>
</div>
<img alt="_images/1cab22c5005f192bdb5e677f50dcd32b6d33738d1a32adf8305e1fb45965e230.png" src="_images/1cab22c5005f192bdb5e677f50dcd32b6d33738d1a32adf8305e1fb45965e230.png" />
</div>
</div>
</section>
<section id="h4-lojas-com-promocoes-ativas-por-mais-tempo-deveriam-vender-mais">
<h3><strong>H4.</strong> Lojas com promoções ativas por mais tempo deveriam vender mais.<a class="headerlink" href="#h4-lojas-com-promocoes-ativas-por-mais-tempo-deveriam-vender-mais" title="Permalink to this heading">#</a></h3>
<p><strong>FALSA</strong> Lojas com promocoes ativas por mais tempo vendem menos, depois de um certo periodo de promocao</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">aux1</span> <span class="o">=</span> <span class="n">df7</span><span class="p">[[</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1">#Grafico 1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="c1"># Criar os intervalos para agrupamento</span>
<span class="n">intervalos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Agrupar os dados por intervalo e calcular a média das vendas</span>

<span class="n">dados_agrupados</span> <span class="o">=</span> <span class="n">aux1</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">intervalos</span><span class="p">)[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">aux2</span> <span class="o">=</span> <span class="n">aux1</span><span class="p">[</span><span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="c1"># promo extendido</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dados_agrupados</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">20</span> <span class="p">)</span>


<span class="c1">#Grafico 2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux2</span> <span class="p">)</span>


<span class="c1">#Grafico 3</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>

<span class="n">aux3</span> <span class="o">=</span> <span class="n">aux1</span><span class="p">[</span><span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="c1"># promo regular</span>

<span class="c1"># Criar os intervalos para agrupamento</span>
<span class="n">intervalos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">aux3</span><span class="p">[</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Agrupar os dados por intervalo e calcular a média das vendas</span>

<span class="n">dados_agrupados</span> <span class="o">=</span> <span class="n">aux3</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">intervalos</span><span class="p">)[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dados_agrupados</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span> <span class="p">)</span>


<span class="c1">#Grafico 4</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux3</span> <span class="p">)</span>


<span class="c1">#Grafico 5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="n">grid</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span> <span class="n">aux1</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span> <span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="_images/197e7cbef545fdec89814fd5cd49e3afb84aac498f651f72ae84f8abea09e490.png" src="_images/197e7cbef545fdec89814fd5cd49e3afb84aac498f651f72ae84f8abea09e490.png" />
</div>
</div>
</section>
<section id="h5-lojas-com-mais-promocoes-consecutivas-deveriam-vender-mais">
<h3><strong>H5.</strong> Lojas com mais promoções consecutivas deveriam vender mais.<a class="headerlink" href="#h5-lojas-com-mais-promocoes-consecutivas-deveriam-vender-mais" title="Permalink to this heading">#</a></h3>
<p><strong>FALSA</strong> Lojas com mais promocoes consecutivas vendem menos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aux1</span> <span class="o">=</span> <span class="n">df7</span><span class="p">[(</span> <span class="n">df7</span><span class="p">[</span><span class="s1">&#39;promo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span> <span class="n">df7</span><span class="p">[</span><span class="s1">&#39;promo2&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)][[</span><span class="s1">&#39;year_week&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;year_week&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">aux1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">aux2</span> <span class="o">=</span> <span class="n">df7</span><span class="p">[(</span> <span class="n">df7</span><span class="p">[</span><span class="s1">&#39;promo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span> <span class="n">df7</span><span class="p">[</span><span class="s1">&#39;promo2&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)][[</span><span class="s1">&#39;year_week&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;year_week&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">aux2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span> <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Tradicional &amp; Extendida&#39;</span><span class="p">,</span> <span class="s1">&#39;Extendida&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5553213585176c648177665569c9d743abcc1c97d0d34380367e846afc9ed95a.png" src="_images/5553213585176c648177665569c9d743abcc1c97d0d34380367e846afc9ed95a.png" />
</div>
</div>
</section>
<section id="h6-lojas-abertas-durante-o-feriado-de-natal-deveriam-vender-em-media-mais-que-os-demais-feriados">
<h3><strong>H6.</strong> Lojas abertas durante o feriado de Natal deveriam vender em média mais que os demais feriados.<a class="headerlink" href="#h6-lojas-abertas-durante-o-feriado-de-natal-deveriam-vender-em-media-mais-que-os-demais-feriados" title="Permalink to this heading">#</a></h3>
<p><strong>Verdadeira</strong> Lojas abertas durante o feriado do Natal vendem mais.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>

<span class="n">aux</span> <span class="o">=</span> <span class="n">df7</span><span class="p">[(</span><span class="n">df7</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;regular_day&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df7</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2015</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="n">aux1</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;state_holiday&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux1</span> <span class="p">)</span>



<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
<span class="n">aux2</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;state_holiday&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">aux2</span>  <span class="o">=</span> <span class="n">aux2</span><span class="p">[</span><span class="n">aux2</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">2015</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux2</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/06e40904d0cfb06a66f4d1a3822316aa1cef3602d35b10764a52b43f70e8c238.png" src="_images/06e40904d0cfb06a66f4d1a3822316aa1cef3602d35b10764a52b43f70e8c238.png" />
</div>
</div>
</section>
<section id="h7-lojas-deveriam-vender-mais-ao-longo-dos-anos">
<h3><strong>H7.</strong> Lojas deveriam vender mais ao longo dos anos.<a class="headerlink" href="#h7-lojas-deveriam-vender-mais-ao-longo-dos-anos" title="Permalink to this heading">#</a></h3>
<p><strong>FALSA</strong> Lojas vendem menos ao longo dos anos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">aux1</span> <span class="o">=</span> <span class="n">df7</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;year&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux1</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux1</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span> <span class="n">aux1</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span> <span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/97e83afed84e8683e093e37b7f61150b26b84bbefe0cf7f1f640aad0b109c1af.png" src="_images/97e83afed84e8683e093e37b7f61150b26b84bbefe0cf7f1f640aad0b109c1af.png" />
</div>
</div>
</section>
<section id="h8-lojas-deveriam-vender-mais-no-segundo-semestre-do-ano">
<h3><strong>H8.</strong> Lojas deveriam vender mais no segundo semestre do ano.<a class="headerlink" href="#h8-lojas-deveriam-vender-mais-no-segundo-semestre-do-ano" title="Permalink to this heading">#</a></h3>
<p><strong>VERDADEIRA</strong> Lojas vendem mais no segundo semestre do ano</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">aux1</span> <span class="o">=</span> <span class="n">df7</span><span class="p">[</span><span class="n">df7</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2015</span><span class="p">]</span>
<span class="n">aux1</span> <span class="o">=</span> <span class="n">aux1</span><span class="p">[[</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;month&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux1</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux1</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span> <span class="n">aux1</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span> <span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a42d2f8f2b3ebc0d3783ab80855f6c3d753ce90285e02873b3a8fe8ac16890c4.png" src="_images/a42d2f8f2b3ebc0d3783ab80855f6c3d753ce90285e02873b3a8fe8ac16890c4.png" />
</div>
</div>
</section>
<section id="h10-lojas-deveriam-vender-mais-na-media-depois-do-dia-10-de-cada-mes">
<h3><strong>H10.</strong> Lojas deveriam vender mais na média depois do dia 10 de cada mês.<a class="headerlink" href="#h10-lojas-deveriam-vender-mais-na-media-depois-do-dia-10-de-cada-mes" title="Permalink to this heading">#</a></h3>
<p><strong>FALSA</strong> Lojas vendem na média menos depois do dia 10 de cada mes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">aux1</span> <span class="o">=</span> <span class="n">df7</span><span class="p">[[</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;day&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux1</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux1</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span> <span class="n">aux1</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span> <span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>

<span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;before_after&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;before_10_days&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">10</span> <span class="k">else</span> <span class="s1">&#39;after_10_days&#39;</span> <span class="p">)</span>
<span class="n">aux2</span> <span class="o">=</span><span class="n">aux1</span><span class="p">[[</span><span class="s1">&#39;before_after&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;before_after&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;before_after&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux2</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/09de9e7ffdc6f7e19f39f2d3f7d46d99dada111473adab836b9d7ade99da74f0.png" src="_images/09de9e7ffdc6f7e19f39f2d3f7d46d99dada111473adab836b9d7ade99da74f0.png" />
</div>
</div>
</section>
<section id="h11-lojas-deveriam-vender-menos-aos-finais-de-semana">
<h3><strong>H11.</strong> Lojas deveriam vender menos aos finais de semana.<a class="headerlink" href="#h11-lojas-deveriam-vender-menos-aos-finais-de-semana" title="Permalink to this heading">#</a></h3>
<p><strong>VERDADEIRA</strong> Lojas vendem menos nos final de semana</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>

<span class="n">aux1</span> <span class="o">=</span> <span class="n">df7</span><span class="p">[[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;day_of_week&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux1</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux1</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span> <span class="n">aux1</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span> <span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5a05ccc192a706fc22e282109f1be85c49f963904e8f533c6f91f681cf29df3d.png" src="_images/5a05ccc192a706fc22e282109f1be85c49f963904e8f533c6f91f681cf29df3d.png" />
</div>
</div>
</section>
<section id="h12-lojas-deveriam-vender-em-media-menos-durante-os-feriados-escolares">
<h3><strong>H12.</strong> Lojas deveriam vender em média menos durante os feriados escolares.<a class="headerlink" href="#h12-lojas-deveriam-vender-em-media-menos-durante-os-feriados-escolares" title="Permalink to this heading">#</a></h3>
<p><strong>FALSA</strong> Lojas vendem mais durante os feriadso escolares</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">aux1</span> <span class="o">=</span> <span class="n">df7</span><span class="p">[[</span><span class="s1">&#39;school_holiday&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;school_holiday&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;school_holiday&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux1</span> <span class="p">)</span>

<span class="n">aux2</span> <span class="o">=</span> <span class="n">df7</span><span class="p">[[</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;school_holiday&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="s1">&#39;school_holiday&#39;</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;school_holiday&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">aux2</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Letivo&#39;</span><span class="p">,</span> <span class="s1">&#39;Férias&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a729ea78bb002ca10ae0a41a3cd46a1be978f7b9c6d313367838a7a464ae7e21.png" src="_images/a729ea78bb002ca10ae0a41a3cd46a1be978f7b9c6d313367838a7a464ae7e21.png" />
</div>
</div>
</section>
<section id="tabela-de-relevancia">
<h3>Tabela de Relevância<a class="headerlink" href="#tabela-de-relevancia" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="c1">#storytelling</span>
<span class="n">tab_H</span> <span class="o">=</span><span class="p">[[</span><span class="s1">&#39;Hipoteses&#39;</span><span class="p">,</span> <span class="s1">&#39;Conclusao&#39;</span><span class="p">,</span> <span class="s1">&#39;Relevancia&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="s1">&#39;Falsa&#39;</span><span class="p">,</span> <span class="s1">&#39;Baixa&#39;</span><span class="p">],</span>  
        <span class="p">[</span><span class="s1">&#39;H2&#39;</span><span class="p">,</span> <span class="s1">&#39;Falsa&#39;</span><span class="p">,</span> <span class="s1">&#39;Media&#39;</span><span class="p">],</span>  
        <span class="p">[</span><span class="s1">&#39;H3&#39;</span><span class="p">,</span> <span class="s1">&#39;Falsa&#39;</span><span class="p">,</span> <span class="s1">&#39;Media&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;H4&#39;</span><span class="p">,</span> <span class="s1">&#39;Falsa&#39;</span><span class="p">,</span> <span class="s1">&#39;Baixa&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;H5&#39;</span><span class="p">,</span> <span class="s1">&#39;Falsa&#39;</span><span class="p">,</span> <span class="s1">&#39;Media&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;H6&#39;</span><span class="p">,</span> <span class="s1">&#39;Verdadeira&#39;</span><span class="p">,</span> <span class="s1">&#39;Media&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;H7&#39;</span><span class="p">,</span> <span class="s1">&#39;Falsa&#39;</span><span class="p">,</span> <span class="s1">&#39;Alta&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;H8&#39;</span><span class="p">,</span> <span class="s1">&#39;Verdadeira&#39;</span><span class="p">,</span> <span class="s1">&#39;Media&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;H9&#39;</span><span class="p">,</span> <span class="s1">&#39;Falsa&#39;</span><span class="p">,</span> <span class="s1">&#39;Alta&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;H10&#39;</span><span class="p">,</span> <span class="s1">&#39;Falsa&#39;</span><span class="p">,</span> <span class="s1">&#39;Alta&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;H11&#39;</span><span class="p">,</span> <span class="s1">&#39;Verdadeira&#39;</span><span class="p">,</span> <span class="s1">&#39;Alta&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;H12&#39;</span><span class="p">,</span><span class="s1">&#39;Falsa&#39;</span><span class="p">,</span> <span class="s1">&#39;Baixa&#39;</span><span class="p">]]</span>      
<span class="nb">print</span><span class="p">(</span> <span class="n">tabulate</span><span class="p">(</span> <span class="n">tab_H</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;firstrow&#39;</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Hipoteses    Conclusao    Relevancia
-----------  -----------  ------------
H1           Falsa        Baixa
H2           Falsa        Media
H3           Falsa        Media
H4           Falsa        Baixa
H5           Falsa        Media
H6           Verdadeira   Media
H7           Falsa        Alta
H8           Verdadeira   Media
H9           Falsa        Alta
H10          Falsa        Alta
H11          Verdadeira   Alta
H12          Falsa        Baixa
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="analise-multivariada">
<h2>7.3. Analise Multivariada<a class="headerlink" href="#analise-multivariada" title="Permalink to this heading">#</a></h2>
<section id="variaveis-numericas">
<h3>7.3.1 Variaveis Numéricas<a class="headerlink" href="#variaveis-numericas" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jupyter_settings</span><span class="p">()</span>
<span class="n">num_attributes</span> <span class="o">=</span> <span class="n">df7</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span><span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">])</span>
<span class="n">correlation</span> <span class="o">=</span> <span class="n">num_attributes</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span> <span class="n">correlation</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>.container { width:100% !important; }</style></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="_images/941963cf359714d803d480c5f24ce1703db29c2f8e592cf0bbdc5b39e7908545.png" src="_images/941963cf359714d803d480c5f24ce1703db29c2f8e592cf0bbdc5b39e7908545.png" />
</div>
</div>
</section>
<section id="id1">
<h3>7.3.2 Variaveis Categóricas<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># only categorical data </span>
<span class="n">a</span> <span class="o">=</span> <span class="n">df7</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span> <span class="n">include</span><span class="o">=</span><span class="s1">&#39;object&#39;</span> <span class="p">)</span>
<span class="c1"># Calculate cramer V </span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">cramer_v</span><span class="p">(</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span> <span class="p">)</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">cramer_v</span><span class="p">(</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;store_type&#39;</span><span class="p">]</span> <span class="p">)</span>
<span class="n">a3</span> <span class="o">=</span> <span class="n">cramer_v</span><span class="p">(</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span> <span class="p">)</span>


<span class="n">a4</span> <span class="o">=</span> <span class="n">cramer_v</span><span class="p">(</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;store_type&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span> <span class="p">)</span>
<span class="n">a5</span> <span class="o">=</span> <span class="n">cramer_v</span><span class="p">(</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;store_type&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;store_type&#39;</span><span class="p">]</span> <span class="p">)</span>
<span class="n">a6</span> <span class="o">=</span> <span class="n">cramer_v</span><span class="p">(</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;store_type&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span> <span class="p">)</span>



<span class="n">a7</span> <span class="o">=</span> <span class="n">cramer_v</span><span class="p">(</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span> <span class="p">)</span>
<span class="n">a8</span> <span class="o">=</span> <span class="n">cramer_v</span><span class="p">(</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;store_type&#39;</span><span class="p">]</span> <span class="p">)</span>
<span class="n">a9</span> <span class="o">=</span> <span class="n">cramer_v</span><span class="p">(</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span> <span class="p">)</span>


<span class="c1"># Final dataset</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span><span class="p">],</span> 
               <span class="s1">&#39;store_type&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">a4</span><span class="p">,</span> <span class="n">a5</span><span class="p">,</span> <span class="n">a6</span><span class="p">],</span>
               <span class="s1">&#39;assortment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">a7</span><span class="p">,</span><span class="n">a8</span><span class="p">,</span><span class="n">a9</span><span class="p">]})</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span> <span class="n">d</span><span class="o">.</span><span class="n">columns</span> <span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span> <span class="n">d</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="_images/b8ca93503517ae40554c19f38b620884f578d57957b281aedab7cef6142ad983.png" src="_images/b8ca93503517ae40554c19f38b620884f578d57957b281aedab7cef6142ad983.png" />
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-preparation">
<h1>8. Data Preparation<a class="headerlink" href="#data-preparation" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df8</span> <span class="o">=</span> <span class="n">df7</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="rescaling">
<h2>8.1 Rescaling<a class="headerlink" href="#rescaling" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rs</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">()</span>
<span class="n">mms</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>

<span class="c1"># competition distance</span>
<span class="n">df8</span><span class="p">[</span><span class="s1">&#39;competition_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df8</span><span class="p">[[</span><span class="s1">&#39;competition_distance&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="c1"># competition time month</span>
<span class="n">df8</span><span class="p">[</span><span class="s1">&#39;competition_time_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span> <span class="n">df8</span><span class="p">[[</span><span class="s1">&#39;competition_time_month&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span> <span class="p">)</span>

<span class="c1"># promo time week</span>
<span class="n">df8</span><span class="p">[</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mms</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span> <span class="n">df8</span><span class="p">[[</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span> <span class="p">)</span>

<span class="c1"># year</span>
<span class="n">df8</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mms</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span> <span class="n">df8</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="transformation">
<h2>8.2 Transformation<a class="headerlink" href="#transformation" title="Permalink to this heading">#</a></h2>
<section id="encoding">
<h3>8.2.1 Encoding<a class="headerlink" href="#encoding" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># state_holiday - One Hot Encoding</span>
<span class="n">df8</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span> <span class="n">df8</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span> <span class="p">)</span>

<span class="c1"># store_type - Label Encoding</span>
<span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">df8</span><span class="p">[</span><span class="s1">&#39;store_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span> <span class="n">df8</span><span class="p">[</span><span class="s1">&#39;store_type&#39;</span><span class="p">]</span> <span class="p">)</span>


<span class="c1"># assortment - Ordinal Encoding</span>
<span class="n">assortment_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;basic&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="s1">&#39;extra&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;extended&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">df8</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df8</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="n">assortment_dict</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="response-variable-transformation">
<h3>8.2.2 Response Variable Transformation<a class="headerlink" href="#response-variable-transformation" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Transformação Logaritmica</span>
<span class="n">df8</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">df8</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Distribuição da variavel target após transformação</span>
<span class="n">dist_sales</span><span class="p">(</span><span class="n">df8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b145352cf1c4b0bc76c51b1ef053a5a158e37f92695ca1d32c5ebca26b0a5a34.png" src="_images/b145352cf1c4b0bc76c51b1ef053a5a158e37f92695ca1d32c5ebca26b0a5a34.png" />
</div>
</div>
</section>
<section id="nature-transformation">
<h3>8.2.3 Nature Transformation<a class="headerlink" href="#nature-transformation" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># day of week</span>
<span class="n">df8</span><span class="p">[</span><span class="s1">&#39;day_of_week_sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df8</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">df8</span><span class="p">[</span><span class="s1">&#39;day_of_week_cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df8</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

<span class="c1"># month</span>
<span class="n">df8</span><span class="p">[</span><span class="s1">&#39;month_sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df8</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">12</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">df8</span><span class="p">[</span><span class="s1">&#39;month_cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df8</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">12</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

<span class="c1"># day </span>
<span class="n">df8</span><span class="p">[</span><span class="s1">&#39;day_sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df8</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">30</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">df8</span><span class="p">[</span><span class="s1">&#39;day_cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df8</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">30</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

<span class="c1"># week of year</span>
<span class="n">df8</span><span class="p">[</span><span class="s1">&#39;week_of_year_sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df8</span><span class="p">[</span><span class="s1">&#39;week_of_year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">52</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">df8</span><span class="p">[</span><span class="s1">&#39;week_of_year_cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df8</span><span class="p">[</span><span class="s1">&#39;week_of_year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">52</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Descrição dos dados após alterações</span>
<span class="n">summary_stats</span><span class="p">(</span><span class="n">df8</span><span class="p">,</span> <span class="n">index_target</span><span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_afedd_row2_col0, #T_afedd_row2_col1, #T_afedd_row2_col2, #T_afedd_row2_col3, #T_afedd_row2_col4, #T_afedd_row2_col5, #T_afedd_row2_col6, #T_afedd_row2_col7, #T_afedd_row2_col8, #T_afedd_row2_col9, #T_afedd_row2_col10, #T_afedd_row2_col11 {
  background-color: #ebf2f3;
  color: #000000;
}
</style>
<table id="T_afedd">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_afedd_level0_col0" class="col_heading level0 col0" >counts</th>
      <th id="T_afedd_level0_col1" class="col_heading level0 col1" >mean</th>
      <th id="T_afedd_level0_col2" class="col_heading level0 col2" >std</th>
      <th id="T_afedd_level0_col3" class="col_heading level0 col3" >median</th>
      <th id="T_afedd_level0_col4" class="col_heading level0 col4" >sum</th>
      <th id="T_afedd_level0_col5" class="col_heading level0 col5" >min</th>
      <th id="T_afedd_level0_col6" class="col_heading level0 col6" >max</th>
      <th id="T_afedd_level0_col7" class="col_heading level0 col7" >range</th>
      <th id="T_afedd_level0_col8" class="col_heading level0 col8" >25%</th>
      <th id="T_afedd_level0_col9" class="col_heading level0 col9" >75%</th>
      <th id="T_afedd_level0_col10" class="col_heading level0 col10" >skew</th>
      <th id="T_afedd_level0_col11" class="col_heading level0 col11" >kurt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_afedd_level0_row0" class="row_heading level0 row0" >store</th>
      <td id="T_afedd_row0_col0" class="data row0 col0" >844338.00</td>
      <td id="T_afedd_row0_col1" class="data row0 col1" >558.42</td>
      <td id="T_afedd_row0_col2" class="data row0 col2" >321.73</td>
      <td id="T_afedd_row0_col3" class="data row0 col3" >558.00</td>
      <td id="T_afedd_row0_col4" class="data row0 col4" >471496386.00</td>
      <td id="T_afedd_row0_col5" class="data row0 col5" >1.00</td>
      <td id="T_afedd_row0_col6" class="data row0 col6" >1115.00</td>
      <td id="T_afedd_row0_col7" class="data row0 col7" >1114.00</td>
      <td id="T_afedd_row0_col8" class="data row0 col8" >280.00</td>
      <td id="T_afedd_row0_col9" class="data row0 col9" >837.00</td>
      <td id="T_afedd_row0_col10" class="data row0 col10" >0.00</td>
      <td id="T_afedd_row0_col11" class="data row0 col11" >-1.20</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row1" class="row_heading level0 row1" >day_of_week</th>
      <td id="T_afedd_row1_col0" class="data row1 col0" >844338.00</td>
      <td id="T_afedd_row1_col1" class="data row1 col1" >3.52</td>
      <td id="T_afedd_row1_col2" class="data row1 col2" >1.72</td>
      <td id="T_afedd_row1_col3" class="data row1 col3" >3.00</td>
      <td id="T_afedd_row1_col4" class="data row1 col4" >2972365.00</td>
      <td id="T_afedd_row1_col5" class="data row1 col5" >1.00</td>
      <td id="T_afedd_row1_col6" class="data row1 col6" >7.00</td>
      <td id="T_afedd_row1_col7" class="data row1 col7" >6.00</td>
      <td id="T_afedd_row1_col8" class="data row1 col8" >2.00</td>
      <td id="T_afedd_row1_col9" class="data row1 col9" >5.00</td>
      <td id="T_afedd_row1_col10" class="data row1 col10" >0.02</td>
      <td id="T_afedd_row1_col11" class="data row1 col11" >-1.26</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row2" class="row_heading level0 row2" >sales</th>
      <td id="T_afedd_row2_col0" class="data row2 col0" >844338.00</td>
      <td id="T_afedd_row2_col1" class="data row2 col1" >8.76</td>
      <td id="T_afedd_row2_col2" class="data row2 col2" >0.43</td>
      <td id="T_afedd_row2_col3" class="data row2 col3" >8.76</td>
      <td id="T_afedd_row2_col4" class="data row2 col4" >7394489.96</td>
      <td id="T_afedd_row2_col5" class="data row2 col5" >3.85</td>
      <td id="T_afedd_row2_col6" class="data row2 col6" >10.63</td>
      <td id="T_afedd_row2_col7" class="data row2 col7" >6.78</td>
      <td id="T_afedd_row2_col8" class="data row2 col8" >8.49</td>
      <td id="T_afedd_row2_col9" class="data row2 col9" >9.03</td>
      <td id="T_afedd_row2_col10" class="data row2 col10" >-0.11</td>
      <td id="T_afedd_row2_col11" class="data row2 col11" >0.65</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row3" class="row_heading level0 row3" >promo</th>
      <td id="T_afedd_row3_col0" class="data row3 col0" >844338.00</td>
      <td id="T_afedd_row3_col1" class="data row3 col1" >0.45</td>
      <td id="T_afedd_row3_col2" class="data row3 col2" >0.50</td>
      <td id="T_afedd_row3_col3" class="data row3 col3" >0.00</td>
      <td id="T_afedd_row3_col4" class="data row3 col4" >376875.00</td>
      <td id="T_afedd_row3_col5" class="data row3 col5" >0.00</td>
      <td id="T_afedd_row3_col6" class="data row3 col6" >1.00</td>
      <td id="T_afedd_row3_col7" class="data row3 col7" >1.00</td>
      <td id="T_afedd_row3_col8" class="data row3 col8" >0.00</td>
      <td id="T_afedd_row3_col9" class="data row3 col9" >1.00</td>
      <td id="T_afedd_row3_col10" class="data row3 col10" >0.22</td>
      <td id="T_afedd_row3_col11" class="data row3 col11" >-1.95</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row4" class="row_heading level0 row4" >school_holiday</th>
      <td id="T_afedd_row4_col0" class="data row4 col0" >844338.00</td>
      <td id="T_afedd_row4_col1" class="data row4 col1" >0.19</td>
      <td id="T_afedd_row4_col2" class="data row4 col2" >0.40</td>
      <td id="T_afedd_row4_col3" class="data row4 col3" >0.00</td>
      <td id="T_afedd_row4_col4" class="data row4 col4" >163445.00</td>
      <td id="T_afedd_row4_col5" class="data row4 col5" >0.00</td>
      <td id="T_afedd_row4_col6" class="data row4 col6" >1.00</td>
      <td id="T_afedd_row4_col7" class="data row4 col7" >1.00</td>
      <td id="T_afedd_row4_col8" class="data row4 col8" >0.00</td>
      <td id="T_afedd_row4_col9" class="data row4 col9" >0.00</td>
      <td id="T_afedd_row4_col10" class="data row4 col10" >1.55</td>
      <td id="T_afedd_row4_col11" class="data row4 col11" >0.41</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row5" class="row_heading level0 row5" >store_type</th>
      <td id="T_afedd_row5_col0" class="data row5 col0" >844338.00</td>
      <td id="T_afedd_row5_col1" class="data row5 col1" >1.21</td>
      <td id="T_afedd_row5_col2" class="data row5 col2" >1.36</td>
      <td id="T_afedd_row5_col3" class="data row5 col3" >0.00</td>
      <td id="T_afedd_row5_col4" class="data row5 col4" >1017800.00</td>
      <td id="T_afedd_row5_col5" class="data row5 col5" >0.00</td>
      <td id="T_afedd_row5_col6" class="data row5 col6" >3.00</td>
      <td id="T_afedd_row5_col7" class="data row5 col7" >3.00</td>
      <td id="T_afedd_row5_col8" class="data row5 col8" >0.00</td>
      <td id="T_afedd_row5_col9" class="data row5 col9" >3.00</td>
      <td id="T_afedd_row5_col10" class="data row5 col10" >0.35</td>
      <td id="T_afedd_row5_col11" class="data row5 col11" >-1.73</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row6" class="row_heading level0 row6" >assortment</th>
      <td id="T_afedd_row6_col0" class="data row6 col0" >844338.00</td>
      <td id="T_afedd_row6_col1" class="data row6 col1" >1.94</td>
      <td id="T_afedd_row6_col2" class="data row6 col2" >0.99</td>
      <td id="T_afedd_row6_col3" class="data row6 col3" >1.00</td>
      <td id="T_afedd_row6_col4" class="data row6 col4" >1635055.00</td>
      <td id="T_afedd_row6_col5" class="data row6 col5" >1.00</td>
      <td id="T_afedd_row6_col6" class="data row6 col6" >3.00</td>
      <td id="T_afedd_row6_col7" class="data row6 col7" >2.00</td>
      <td id="T_afedd_row6_col8" class="data row6 col8" >1.00</td>
      <td id="T_afedd_row6_col9" class="data row6 col9" >3.00</td>
      <td id="T_afedd_row6_col10" class="data row6 col10" >0.13</td>
      <td id="T_afedd_row6_col11" class="data row6 col11" >-1.97</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row7" class="row_heading level0 row7" >competition_distance</th>
      <td id="T_afedd_row7_col0" class="data row7 col0" >844338.00</td>
      <td id="T_afedd_row7_col1" class="data row7 col1" >0.59</td>
      <td id="T_afedd_row7_col2" class="data row7 col2" >2.03</td>
      <td id="T_afedd_row7_col3" class="data row7 col3" >0.00</td>
      <td id="T_afedd_row7_col4" class="data row7 col4" >494595.16</td>
      <td id="T_afedd_row7_col5" class="data row7 col5" >-0.37</td>
      <td id="T_afedd_row7_col6" class="data row7 col6" >31.88</td>
      <td id="T_afedd_row7_col7" class="data row7 col7" >32.25</td>
      <td id="T_afedd_row7_col8" class="data row7 col8" >-0.26</td>
      <td id="T_afedd_row7_col9" class="data row7 col9" >0.74</td>
      <td id="T_afedd_row7_col10" class="data row7 col10" >10.13</td>
      <td id="T_afedd_row7_col11" class="data row7 col11" >145.29</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row8" class="row_heading level0 row8" >competition_open_since_month</th>
      <td id="T_afedd_row8_col0" class="data row8 col0" >844338.00</td>
      <td id="T_afedd_row8_col1" class="data row8 col1" >6.79</td>
      <td id="T_afedd_row8_col2" class="data row8 col2" >3.31</td>
      <td id="T_afedd_row8_col3" class="data row8 col3" >7.00</td>
      <td id="T_afedd_row8_col4" class="data row8 col4" >5730822.00</td>
      <td id="T_afedd_row8_col5" class="data row8 col5" >1.00</td>
      <td id="T_afedd_row8_col6" class="data row8 col6" >12.00</td>
      <td id="T_afedd_row8_col7" class="data row8 col7" >11.00</td>
      <td id="T_afedd_row8_col8" class="data row8 col8" >4.00</td>
      <td id="T_afedd_row8_col9" class="data row8 col9" >10.00</td>
      <td id="T_afedd_row8_col10" class="data row8 col10" >-0.05</td>
      <td id="T_afedd_row8_col11" class="data row8 col11" >-1.23</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row9" class="row_heading level0 row9" >competition_open_since_year</th>
      <td id="T_afedd_row9_col0" class="data row9 col0" >844338.00</td>
      <td id="T_afedd_row9_col1" class="data row9 col1" >2010.33</td>
      <td id="T_afedd_row9_col2" class="data row9 col2" >5.50</td>
      <td id="T_afedd_row9_col3" class="data row9 col3" >2012.00</td>
      <td id="T_afedd_row9_col4" class="data row9 col4" >1697398942.00</td>
      <td id="T_afedd_row9_col5" class="data row9 col5" >1900.00</td>
      <td id="T_afedd_row9_col6" class="data row9 col6" >2015.00</td>
      <td id="T_afedd_row9_col7" class="data row9 col7" >115.00</td>
      <td id="T_afedd_row9_col8" class="data row9 col8" >2008.00</td>
      <td id="T_afedd_row9_col9" class="data row9 col9" >2014.00</td>
      <td id="T_afedd_row9_col10" class="data row9 col10" >-7.22</td>
      <td id="T_afedd_row9_col11" class="data row9 col11" >123.90</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row10" class="row_heading level0 row10" >promo2</th>
      <td id="T_afedd_row10_col0" class="data row10 col0" >844338.00</td>
      <td id="T_afedd_row10_col1" class="data row10 col1" >0.50</td>
      <td id="T_afedd_row10_col2" class="data row10 col2" >0.50</td>
      <td id="T_afedd_row10_col3" class="data row10 col3" >0.00</td>
      <td id="T_afedd_row10_col4" class="data row10 col4" >421046.00</td>
      <td id="T_afedd_row10_col5" class="data row10 col5" >0.00</td>
      <td id="T_afedd_row10_col6" class="data row10 col6" >1.00</td>
      <td id="T_afedd_row10_col7" class="data row10 col7" >1.00</td>
      <td id="T_afedd_row10_col8" class="data row10 col8" >0.00</td>
      <td id="T_afedd_row10_col9" class="data row10 col9" >1.00</td>
      <td id="T_afedd_row10_col10" class="data row10 col10" >0.01</td>
      <td id="T_afedd_row10_col11" class="data row10 col11" >-2.00</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row11" class="row_heading level0 row11" >promo2_since_week</th>
      <td id="T_afedd_row11_col0" class="data row11 col0" >844338.00</td>
      <td id="T_afedd_row11_col1" class="data row11 col1" >23.63</td>
      <td id="T_afedd_row11_col2" class="data row11 col2" >14.29</td>
      <td id="T_afedd_row11_col3" class="data row11 col3" >22.00</td>
      <td id="T_afedd_row11_col4" class="data row11 col4" >19950933.00</td>
      <td id="T_afedd_row11_col5" class="data row11 col5" >1.00</td>
      <td id="T_afedd_row11_col6" class="data row11 col6" >52.00</td>
      <td id="T_afedd_row11_col7" class="data row11 col7" >51.00</td>
      <td id="T_afedd_row11_col8" class="data row11 col8" >12.00</td>
      <td id="T_afedd_row11_col9" class="data row11 col9" >37.00</td>
      <td id="T_afedd_row11_col10" class="data row11 col10" >0.17</td>
      <td id="T_afedd_row11_col11" class="data row11 col11" >-1.19</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row12" class="row_heading level0 row12" >promo2_since_year</th>
      <td id="T_afedd_row12_col0" class="data row12 col0" >844338.00</td>
      <td id="T_afedd_row12_col1" class="data row12 col1" >2012.80</td>
      <td id="T_afedd_row12_col2" class="data row12 col2" >1.66</td>
      <td id="T_afedd_row12_col3" class="data row12 col3" >2013.00</td>
      <td id="T_afedd_row12_col4" class="data row12 col4" >1699481766.00</td>
      <td id="T_afedd_row12_col5" class="data row12 col5" >2009.00</td>
      <td id="T_afedd_row12_col6" class="data row12 col6" >2015.00</td>
      <td id="T_afedd_row12_col7" class="data row12 col7" >6.00</td>
      <td id="T_afedd_row12_col8" class="data row12 col8" >2012.00</td>
      <td id="T_afedd_row12_col9" class="data row12 col9" >2014.00</td>
      <td id="T_afedd_row12_col10" class="data row12 col10" >-0.79</td>
      <td id="T_afedd_row12_col11" class="data row12 col11" >-0.20</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row13" class="row_heading level0 row13" >is_promo</th>
      <td id="T_afedd_row13_col0" class="data row13 col0" >844338.00</td>
      <td id="T_afedd_row13_col1" class="data row13 col1" >0.16</td>
      <td id="T_afedd_row13_col2" class="data row13 col2" >0.37</td>
      <td id="T_afedd_row13_col3" class="data row13 col3" >0.00</td>
      <td id="T_afedd_row13_col4" class="data row13 col4" >135869.00</td>
      <td id="T_afedd_row13_col5" class="data row13 col5" >0.00</td>
      <td id="T_afedd_row13_col6" class="data row13 col6" >1.00</td>
      <td id="T_afedd_row13_col7" class="data row13 col7" >1.00</td>
      <td id="T_afedd_row13_col8" class="data row13 col8" >0.00</td>
      <td id="T_afedd_row13_col9" class="data row13 col9" >0.00</td>
      <td id="T_afedd_row13_col10" class="data row13 col10" >1.85</td>
      <td id="T_afedd_row13_col11" class="data row13 col11" >1.41</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row14" class="row_heading level0 row14" >year</th>
      <td id="T_afedd_row14_col0" class="data row14 col0" >844338.00</td>
      <td id="T_afedd_row14_col1" class="data row14 col1" >0.42</td>
      <td id="T_afedd_row14_col2" class="data row14 col2" >0.39</td>
      <td id="T_afedd_row14_col3" class="data row14 col3" >0.50</td>
      <td id="T_afedd_row14_col4" class="data row14 col4" >351221.50</td>
      <td id="T_afedd_row14_col5" class="data row14 col5" >0.00</td>
      <td id="T_afedd_row14_col6" class="data row14 col6" >1.00</td>
      <td id="T_afedd_row14_col7" class="data row14 col7" >1.00</td>
      <td id="T_afedd_row14_col8" class="data row14 col8" >0.00</td>
      <td id="T_afedd_row14_col9" class="data row14 col9" >0.50</td>
      <td id="T_afedd_row14_col10" class="data row14 col10" >0.30</td>
      <td id="T_afedd_row14_col11" class="data row14 col11" >-1.29</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row15" class="row_heading level0 row15" >month</th>
      <td id="T_afedd_row15_col0" class="data row15 col0" >844338.00</td>
      <td id="T_afedd_row15_col1" class="data row15 col1" >5.85</td>
      <td id="T_afedd_row15_col2" class="data row15 col2" >3.32</td>
      <td id="T_afedd_row15_col3" class="data row15 col3" >6.00</td>
      <td id="T_afedd_row15_col4" class="data row15 col4" >4935809.00</td>
      <td id="T_afedd_row15_col5" class="data row15 col5" >1.00</td>
      <td id="T_afedd_row15_col6" class="data row15 col6" >12.00</td>
      <td id="T_afedd_row15_col7" class="data row15 col7" >11.00</td>
      <td id="T_afedd_row15_col8" class="data row15 col8" >3.00</td>
      <td id="T_afedd_row15_col9" class="data row15 col9" >8.00</td>
      <td id="T_afedd_row15_col10" class="data row15 col10" >0.26</td>
      <td id="T_afedd_row15_col11" class="data row15 col11" >-1.03</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row16" class="row_heading level0 row16" >day</th>
      <td id="T_afedd_row16_col0" class="data row16 col0" >844338.00</td>
      <td id="T_afedd_row16_col1" class="data row16 col1" >15.84</td>
      <td id="T_afedd_row16_col2" class="data row16 col2" >8.68</td>
      <td id="T_afedd_row16_col3" class="data row16 col3" >16.00</td>
      <td id="T_afedd_row16_col4" class="data row16 col4" >13370688.00</td>
      <td id="T_afedd_row16_col5" class="data row16 col5" >1.00</td>
      <td id="T_afedd_row16_col6" class="data row16 col6" >31.00</td>
      <td id="T_afedd_row16_col7" class="data row16 col7" >30.00</td>
      <td id="T_afedd_row16_col8" class="data row16 col8" >8.00</td>
      <td id="T_afedd_row16_col9" class="data row16 col9" >23.00</td>
      <td id="T_afedd_row16_col10" class="data row16 col10" >0.01</td>
      <td id="T_afedd_row16_col11" class="data row16 col11" >-1.18</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row17" class="row_heading level0 row17" >week_of_year</th>
      <td id="T_afedd_row17_col0" class="data row17 col0" >844338.00</td>
      <td id="T_afedd_row17_col1" class="data row17 col1" >23.65</td>
      <td id="T_afedd_row17_col2" class="data row17 col2" >14.39</td>
      <td id="T_afedd_row17_col3" class="data row17 col3" >23.00</td>
      <td id="T_afedd_row17_col4" class="data row17 col4" >19966015.00</td>
      <td id="T_afedd_row17_col5" class="data row17 col5" >1.00</td>
      <td id="T_afedd_row17_col6" class="data row17 col6" >52.00</td>
      <td id="T_afedd_row17_col7" class="data row17 col7" >51.00</td>
      <td id="T_afedd_row17_col8" class="data row17 col8" >11.00</td>
      <td id="T_afedd_row17_col9" class="data row17 col9" >35.00</td>
      <td id="T_afedd_row17_col10" class="data row17 col10" >0.26</td>
      <td id="T_afedd_row17_col11" class="data row17 col11" >-1.03</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row18" class="row_heading level0 row18" >competition_time_month</th>
      <td id="T_afedd_row18_col0" class="data row18 col0" >844338.00</td>
      <td id="T_afedd_row18_col1" class="data row18 col1" >0.36</td>
      <td id="T_afedd_row18_col2" class="data row18 col2" >0.89</td>
      <td id="T_afedd_row18_col3" class="data row18 col3" >0.00</td>
      <td id="T_afedd_row18_col4" class="data row18 col4" >303227.76</td>
      <td id="T_afedd_row18_col5" class="data row18 col5" >-0.22</td>
      <td id="T_afedd_row18_col6" class="data row18 col6" >18.80</td>
      <td id="T_afedd_row18_col7" class="data row18 col7" >19.01</td>
      <td id="T_afedd_row18_col8" class="data row18 col8" >-0.22</td>
      <td id="T_afedd_row18_col9" class="data row18 col9" >0.78</td>
      <td id="T_afedd_row18_col10" class="data row18 col10" >7.55</td>
      <td id="T_afedd_row18_col11" class="data row18 col11" >131.81</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row19" class="row_heading level0 row19" >promo_time_week</th>
      <td id="T_afedd_row19_col0" class="data row19 col0" >844338.00</td>
      <td id="T_afedd_row19_col1" class="data row19 col1" >0.41</td>
      <td id="T_afedd_row19_col2" class="data row19 col2" >0.19</td>
      <td id="T_afedd_row19_col3" class="data row19 col3" >0.29</td>
      <td id="T_afedd_row19_col4" class="data row19 col4" >346968.49</td>
      <td id="T_afedd_row19_col5" class="data row19 col5" >0.00</td>
      <td id="T_afedd_row19_col6" class="data row19 col6" >1.00</td>
      <td id="T_afedd_row19_col7" class="data row19 col7" >1.00</td>
      <td id="T_afedd_row19_col8" class="data row19 col8" >0.29</td>
      <td id="T_afedd_row19_col9" class="data row19 col9" >0.54</td>
      <td id="T_afedd_row19_col10" class="data row19 col10" >1.10</td>
      <td id="T_afedd_row19_col11" class="data row19 col11" >0.11</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row20" class="row_heading level0 row20" >day_of_week_sin</th>
      <td id="T_afedd_row20_col0" class="data row20 col0" >844338.00</td>
      <td id="T_afedd_row20_col1" class="data row20 col1" >0.00</td>
      <td id="T_afedd_row20_col2" class="data row20 col2" >0.76</td>
      <td id="T_afedd_row20_col3" class="data row20 col3" >0.43</td>
      <td id="T_afedd_row20_col4" class="data row20 col4" >3276.19</td>
      <td id="T_afedd_row20_col5" class="data row20 col5" >-0.97</td>
      <td id="T_afedd_row20_col6" class="data row20 col6" >0.97</td>
      <td id="T_afedd_row20_col7" class="data row20 col7" >1.95</td>
      <td id="T_afedd_row20_col8" class="data row20 col8" >-0.78</td>
      <td id="T_afedd_row20_col9" class="data row20 col9" >0.78</td>
      <td id="T_afedd_row20_col10" class="data row20 col10" >-0.01</td>
      <td id="T_afedd_row20_col11" class="data row20 col11" >-1.71</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row21" class="row_heading level0 row21" >day_of_week_cos</th>
      <td id="T_afedd_row21_col0" class="data row21 col0" >844338.00</td>
      <td id="T_afedd_row21_col1" class="data row21 col1" >-0.16</td>
      <td id="T_afedd_row21_col2" class="data row21 col2" >0.63</td>
      <td id="T_afedd_row21_col3" class="data row21 col3" >-0.22</td>
      <td id="T_afedd_row21_col4" class="data row21 col4" >-132869.54</td>
      <td id="T_afedd_row21_col5" class="data row21 col5" >-0.90</td>
      <td id="T_afedd_row21_col6" class="data row21 col6" >1.00</td>
      <td id="T_afedd_row21_col7" class="data row21 col7" >1.90</td>
      <td id="T_afedd_row21_col8" class="data row21 col8" >-0.90</td>
      <td id="T_afedd_row21_col9" class="data row21 col9" >0.62</td>
      <td id="T_afedd_row21_col10" class="data row21 col10" >0.12</td>
      <td id="T_afedd_row21_col11" class="data row21 col11" >-1.49</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row22" class="row_heading level0 row22" >month_sin</th>
      <td id="T_afedd_row22_col0" class="data row22 col0" >844338.00</td>
      <td id="T_afedd_row22_col1" class="data row22 col1" >0.11</td>
      <td id="T_afedd_row22_col2" class="data row22 col2" >0.69</td>
      <td id="T_afedd_row22_col3" class="data row22 col3" >0.00</td>
      <td id="T_afedd_row22_col4" class="data row22 col4" >95375.64</td>
      <td id="T_afedd_row22_col5" class="data row22 col5" >-1.00</td>
      <td id="T_afedd_row22_col6" class="data row22 col6" >1.00</td>
      <td id="T_afedd_row22_col7" class="data row22 col7" >2.00</td>
      <td id="T_afedd_row22_col8" class="data row22 col8" >-0.50</td>
      <td id="T_afedd_row22_col9" class="data row22 col9" >0.87</td>
      <td id="T_afedd_row22_col10" class="data row22 col10" >-0.24</td>
      <td id="T_afedd_row22_col11" class="data row22 col11" >-1.42</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row23" class="row_heading level0 row23" >month_cos</th>
      <td id="T_afedd_row23_col0" class="data row23 col0" >844338.00</td>
      <td id="T_afedd_row23_col1" class="data row23 col1" >-0.07</td>
      <td id="T_afedd_row23_col2" class="data row23 col2" >0.71</td>
      <td id="T_afedd_row23_col3" class="data row23 col3" >-0.00</td>
      <td id="T_afedd_row23_col4" class="data row23 col4" >-57677.38</td>
      <td id="T_afedd_row23_col5" class="data row23 col5" >-1.00</td>
      <td id="T_afedd_row23_col6" class="data row23 col6" >1.00</td>
      <td id="T_afedd_row23_col7" class="data row23 col7" >2.00</td>
      <td id="T_afedd_row23_col8" class="data row23 col8" >-0.87</td>
      <td id="T_afedd_row23_col9" class="data row23 col9" >0.50</td>
      <td id="T_afedd_row23_col10" class="data row23 col10" >0.12</td>
      <td id="T_afedd_row23_col11" class="data row23 col11" >-1.50</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row24" class="row_heading level0 row24" >day_sin</th>
      <td id="T_afedd_row24_col0" class="data row24 col0" >844338.00</td>
      <td id="T_afedd_row24_col1" class="data row24 col1" >0.00</td>
      <td id="T_afedd_row24_col2" class="data row24 col2" >0.71</td>
      <td id="T_afedd_row24_col3" class="data row24 col3" >0.00</td>
      <td id="T_afedd_row24_col4" class="data row24 col4" >3619.65</td>
      <td id="T_afedd_row24_col5" class="data row24 col5" >-0.99</td>
      <td id="T_afedd_row24_col6" class="data row24 col6" >0.99</td>
      <td id="T_afedd_row24_col7" class="data row24 col7" >1.99</td>
      <td id="T_afedd_row24_col8" class="data row24 col8" >-0.74</td>
      <td id="T_afedd_row24_col9" class="data row24 col9" >0.74</td>
      <td id="T_afedd_row24_col10" class="data row24 col10" >-0.02</td>
      <td id="T_afedd_row24_col11" class="data row24 col11" >-1.50</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row25" class="row_heading level0 row25" >day_cos</th>
      <td id="T_afedd_row25_col0" class="data row25 col0" >844338.00</td>
      <td id="T_afedd_row25_col1" class="data row25 col1" >-0.00</td>
      <td id="T_afedd_row25_col2" class="data row25 col2" >0.71</td>
      <td id="T_afedd_row25_col3" class="data row25 col3" >-0.10</td>
      <td id="T_afedd_row25_col4" class="data row25 col4" >-2531.10</td>
      <td id="T_afedd_row25_col5" class="data row25 col5" >-1.00</td>
      <td id="T_afedd_row25_col6" class="data row25 col6" >1.00</td>
      <td id="T_afedd_row25_col7" class="data row25 col7" >2.00</td>
      <td id="T_afedd_row25_col8" class="data row25 col8" >-0.67</td>
      <td id="T_afedd_row25_col9" class="data row25 col9" >0.67</td>
      <td id="T_afedd_row25_col10" class="data row25 col10" >0.01</td>
      <td id="T_afedd_row25_col11" class="data row25 col11" >-1.50</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row26" class="row_heading level0 row26" >week_of_year_sin</th>
      <td id="T_afedd_row26_col0" class="data row26 col0" >844338.00</td>
      <td id="T_afedd_row26_col1" class="data row26 col1" >0.13</td>
      <td id="T_afedd_row26_col2" class="data row26 col2" >0.69</td>
      <td id="T_afedd_row26_col3" class="data row26 col3" >0.24</td>
      <td id="T_afedd_row26_col4" class="data row26 col4" >106643.13</td>
      <td id="T_afedd_row26_col5" class="data row26 col5" >-1.00</td>
      <td id="T_afedd_row26_col6" class="data row26 col6" >1.00</td>
      <td id="T_afedd_row26_col7" class="data row26 col7" >2.00</td>
      <td id="T_afedd_row26_col8" class="data row26 col8" >-0.57</td>
      <td id="T_afedd_row26_col9" class="data row26 col9" >0.82</td>
      <td id="T_afedd_row26_col10" class="data row26 col10" >-0.28</td>
      <td id="T_afedd_row26_col11" class="data row26 col11" >-1.38</td>
    </tr>
    <tr>
      <th id="T_afedd_level0_row27" class="row_heading level0 row27" >week_of_year_cos</th>
      <td id="T_afedd_row27_col0" class="data row27 col0" >844338.00</td>
      <td id="T_afedd_row27_col1" class="data row27 col1" >-0.05</td>
      <td id="T_afedd_row27_col2" class="data row27 col2" >0.71</td>
      <td id="T_afedd_row27_col3" class="data row27 col3" >-0.12</td>
      <td id="T_afedd_row27_col4" class="data row27 col4" >-38251.58</td>
      <td id="T_afedd_row27_col5" class="data row27 col5" >-1.00</td>
      <td id="T_afedd_row27_col6" class="data row27 col6" >1.00</td>
      <td id="T_afedd_row27_col7" class="data row27 col7" >2.00</td>
      <td id="T_afedd_row27_col8" class="data row27 col8" >-0.75</td>
      <td id="T_afedd_row27_col9" class="data row27 col9" >0.66</td>
      <td id="T_afedd_row27_col10" class="data row27 col10" >0.07</td>
      <td id="T_afedd_row27_col11" class="data row27 col11" >-1.52</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="feature-selection">
<h1>9. Feature Selection<a class="headerlink" href="#feature-selection" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df9</span> <span class="o">=</span> <span class="n">df8</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="split-dataframe-into-training-and-test-dataset">
<h2>9.1 Split dataframe into training and test dataset<a class="headerlink" href="#split-dataframe-into-training-and-test-dataset" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Excluindo colunas </span>

<span class="n">cols_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;week_of_year&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day_of_week&#39;</span><span class="p">,</span> <span class="s1">&#39;promo_since&#39;</span><span class="p">,</span> <span class="s1">&#39;competition_since&#39;</span><span class="p">,</span> <span class="s1">&#39;year_week&#39;</span> <span class="p">]</span>
<span class="n">df9</span> <span class="o">=</span> <span class="n">df9</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span> <span class="n">cols_drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># training dataset</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">df9</span><span class="p">[</span><span class="n">df9</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;2015-06-19&#39;</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span>

<span class="c1"># test dataset</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">df9</span><span class="p">[</span><span class="n">df9</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s1">&#39;2015-06-19&#39;</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;Training Min Date: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;Training Max Date: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Test Min Date: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">X_test</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;Test Max Date: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">X_test</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training Min Date: 2013-01-01 00:00:00
Training Max Date: 2015-06-18 00:00:00

Test Min Date: 2015-06-19 00:00:00
Test Max Date: 2015-07-31 00:00:00
</pre></div>
</div>
</div>
</div>
</section>
<section id="rfe-as-feature-selector">
<h2>9.2. RFE as Feature Selector<a class="headerlink" href="#rfe-as-feature-selector" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Registrar o tempo antes de executar as operações</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># training and test dataset for RFE</span>
<span class="n">X_train_n</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">y_train_n</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="c1"># define xgbRegressor</span>
<span class="n">xgb</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">selector</span> <span class="o">=</span> <span class="n">RFE</span><span class="p">(</span><span class="n">xgb</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_n</span><span class="p">,</span> <span class="n">y_train_n</span><span class="p">)</span>

<span class="c1"># Calcular o tempo gasto</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Imprimir o tempo gasto</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tempo gasto: </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> segundos&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting estimator with 27 features.
Fitting estimator with 26 features.
Fitting estimator with 25 features.
Fitting estimator with 24 features.
Fitting estimator with 23 features.
Fitting estimator with 22 features.
Fitting estimator with 21 features.
Fitting estimator with 20 features.
Fitting estimator with 19 features.
Fitting estimator with 18 features.
Fitting estimator with 17 features.
Fitting estimator with 16 features.
Fitting estimator with 15 features.
Fitting estimator with 14 features.
Tempo gasto: 823.31 segundos
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Salvar para Documentação</span>
<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;relatorios/selector_RFE.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
<span class="n">cols_select</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">selector</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">cols_select</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;store&#39;,
 &#39;promo&#39;,
 &#39;store_type&#39;,
 &#39;assortment&#39;,
 &#39;competition_distance&#39;,
 &#39;competition_open_since_month&#39;,
 &#39;competition_open_since_year&#39;,
 &#39;promo2&#39;,
 &#39;promo2_since_week&#39;,
 &#39;promo2_since_year&#39;,
 &#39;day_of_week_cos&#39;,
 &#39;month_cos&#39;,
 &#39;day_sin&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ranking gerado pelo modelo</span>

<span class="n">rank_RFE</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;Feature&#39;</span><span class="p">:</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;Ranking&#39;</span><span class="p">:</span> <span class="n">rank</span><span class="p">}</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">selector</span><span class="o">.</span><span class="n">ranking_</span><span class="p">)]</span>

<span class="c1">#salvar para documentação</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rank_RFE</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Ranking&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;relatorios/rank_RFE.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rank</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rank_RFE</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Ranking&#39;</span><span class="p">)</span>
<span class="n">rank</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Feature</th>
      <th>Ranking</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>store</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>promo</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>store_type</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>assortment</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>competition_distance</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>competition_open_since_month</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>competition_open_since_year</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>promo2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>promo2_since_week</td>
      <td>1</td>
    </tr>
    <tr>
      <th>10</th>
      <td>promo2_since_year</td>
      <td>1</td>
    </tr>
    <tr>
      <th>23</th>
      <td>day_sin</td>
      <td>1</td>
    </tr>
    <tr>
      <th>22</th>
      <td>month_cos</td>
      <td>1</td>
    </tr>
    <tr>
      <th>20</th>
      <td>day_of_week_cos</td>
      <td>1</td>
    </tr>
    <tr>
      <th>24</th>
      <td>day_cos</td>
      <td>2</td>
    </tr>
    <tr>
      <th>19</th>
      <td>day_of_week_sin</td>
      <td>3</td>
    </tr>
    <tr>
      <th>14</th>
      <td>promo_time_week</td>
      <td>4</td>
    </tr>
    <tr>
      <th>26</th>
      <td>week_of_year_cos</td>
      <td>5</td>
    </tr>
    <tr>
      <th>21</th>
      <td>month_sin</td>
      <td>6</td>
    </tr>
    <tr>
      <th>25</th>
      <td>week_of_year_sin</td>
      <td>7</td>
    </tr>
    <tr>
      <th>12</th>
      <td>year</td>
      <td>8</td>
    </tr>
    <tr>
      <th>13</th>
      <td>competition_time_month</td>
      <td>9</td>
    </tr>
    <tr>
      <th>18</th>
      <td>state_holiday_regular_day</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>school_holiday</td>
      <td>11</td>
    </tr>
    <tr>
      <th>11</th>
      <td>is_promo</td>
      <td>12</td>
    </tr>
    <tr>
      <th>16</th>
      <td>state_holiday_easter_holiday</td>
      <td>13</td>
    </tr>
    <tr>
      <th>17</th>
      <td>state_holiday_public_holiday</td>
      <td>14</td>
    </tr>
    <tr>
      <th>15</th>
      <td>state_holiday_christmas</td>
      <td>15</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="manual-feature-selection">
<h2>9.3 Manual Feature Selection<a class="headerlink" href="#manual-feature-selection" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols_select</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                <span class="s1">&#39;promo&#39;</span><span class="p">,</span>
                <span class="s1">&#39;store_type&#39;</span><span class="p">,</span>
                <span class="s1">&#39;assortment&#39;</span><span class="p">,</span>
                <span class="s1">&#39;competition_distance&#39;</span><span class="p">,</span>
                <span class="s1">&#39;competition_open_since_month&#39;</span><span class="p">,</span>
                <span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">,</span>
                <span class="s1">&#39;promo2&#39;</span><span class="p">,</span>
                <span class="s1">&#39;promo2_since_week&#39;</span><span class="p">,</span>
                <span class="s1">&#39;promo2_since_year&#39;</span><span class="p">,</span>
                <span class="s1">&#39;day_of_week_cos&#39;</span><span class="p">,</span>
                <span class="s1">&#39;day_of_week_sin&#39;</span><span class="p">,</span>
                <span class="s1">&#39;month_cos&#39;</span><span class="p">,</span>
                <span class="s1">&#39;day_sin&#39;</span><span class="p">,</span>
                <span class="s1">&#39;day_cos&#39;</span><span class="p">,</span>
                <span class="s1">&#39;month_sin&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="machine-learning-modeling">
<h1>10. Machine Learning modeling<a class="headerlink" href="#machine-learning-modeling" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">cols_select</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">cols_select</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<section id="avarage-model">
<h2>10.1 Avarage Model<a class="headerlink" href="#avarage-model" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aux1</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>


<span class="c1">#prediction</span>
<span class="n">aux2</span> <span class="o">=</span> <span class="n">aux1</span><span class="p">[[</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;store&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sales&#39;</span><span class="p">:</span> <span class="s1">&#39;predictions&#39;</span><span class="p">})</span>
<span class="n">aux1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">aux1</span><span class="p">,</span> <span class="n">aux2</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;store&#39;</span><span class="p">)</span>

<span class="n">yhat_baseline</span> <span class="o">=</span> <span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;predictions&#39;</span><span class="p">]</span>

<span class="c1">#performance</span>

<span class="n">baseline_result</span> <span class="o">=</span> <span class="n">ml_error</span><span class="p">(</span><span class="s1">&#39; Average Model&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">y_test</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">yhat_baseline</span><span class="p">))</span>
<span class="n">baseline_result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model Name</th>
      <th>MAE</th>
      <th>MAPE</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Average Model</td>
      <td>1354.800353</td>
      <td>0.2064</td>
      <td>1835.135542</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Teste com a média do passado e prevendo o futuro</span>

<span class="n">aux1</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">aux1</span>
<span class="c1">#prediction</span>
<span class="n">aux2</span> <span class="o">=</span> <span class="n">aux1</span><span class="p">[[</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;store&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sales&#39;</span><span class="p">:</span> <span class="s1">&#39;predictions&#39;</span><span class="p">})</span>
<span class="n">aux1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">aux2</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;store&#39;</span><span class="p">)</span>

<span class="n">yhat_baseline</span> <span class="o">=</span> <span class="n">aux1</span><span class="p">[</span><span class="s1">&#39;predictions&#39;</span><span class="p">]</span>

<span class="c1">#performance</span>

<span class="n">baseline_result</span> <span class="o">=</span> <span class="n">ml_error</span><span class="p">(</span><span class="s1">&#39; Average Model&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">y_test</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">yhat_baseline</span><span class="p">))</span>
<span class="n">baseline_result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model Name</th>
      <th>MAE</th>
      <th>MAPE</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Average Model</td>
      <td>1429.763326</td>
      <td>0.216814</td>
      <td>1939.32873</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Concaternar para o Cross Validation</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="linear-regression-model">
<h2>10.2. Linear Regression Model<a class="headerlink" href="#linear-regression-model" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># model</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>

<span class="c1">#performance</span>
<span class="n">lr_result</span> <span class="o">=</span> <span class="n">timeSeries_CV</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;Linear Regression&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">kfold</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">lr_result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model Name</th>
      <th>MAE CV</th>
      <th>MAPE CV</th>
      <th>RMSE CV</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Linear Regression</td>
      <td>1991.32 +/- 79.87</td>
      <td>0.32 +/- 0.01</td>
      <td>2834.85 +/- 148.89</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="linear-regression-regularized-model-lasso">
<h2>10.3. Linear Regression Regularized Model - Lasso<a class="headerlink" href="#linear-regression-regularized-model-lasso" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Model</span>
<span class="n">lrr</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span> <span class="mf">0.001</span><span class="p">)</span>

<span class="c1">#Performance</span>
<span class="n">lrr_result</span> <span class="o">=</span> <span class="n">timeSeries_CV</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;Linear Regression - Lasso&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">lrr</span><span class="p">,</span> <span class="n">kfold</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">lrr_result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model Name</th>
      <th>MAE CV</th>
      <th>MAPE CV</th>
      <th>RMSE CV</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Linear Regression - Lasso</td>
      <td>1990.09 +/- 78.8</td>
      <td>0.32 +/- 0.01</td>
      <td>2830.26 +/- 141.18</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="random-forest-regressor">
<h2>10.4. Random Forest Regressor<a class="headerlink" href="#random-forest-regressor" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># model</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="p">)</span>

<span class="c1"># performance</span>
<span class="n">rf_result</span> <span class="o">=</span> <span class="n">timeSeries_CV</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;Random Forest Regressor&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">rf</span><span class="p">,</span> <span class="n">kfold</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">rf_result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model Name</th>
      <th>MAE CV</th>
      <th>MAPE CV</th>
      <th>RMSE CV</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Random Forest Regressor</td>
      <td>1042.48 +/- 232.24</td>
      <td>0.15 +/- 0.03</td>
      <td>1637.8 +/- 412.93</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="xgboost-regressor">
<h2>10.5. XGBoost Regressor<a class="headerlink" href="#xgboost-regressor" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># model</span>
<span class="n">model_xgb</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">()</span>

<span class="c1"># performance</span>
<span class="n">xgb_result</span> <span class="o">=</span> <span class="n">timeSeries_CV</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span> <span class="s1">&#39;XGBoost Regressor&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model_xgb</span><span class="p">,</span> <span class="n">kfold</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">xgb_result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model Name</th>
      <th>MAE CV</th>
      <th>MAPE CV</th>
      <th>RMSE CV</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>XGBoost Regressor</td>
      <td>1096.91 +/- 157.56</td>
      <td>0.16 +/- 0.02</td>
      <td>1603.58 +/- 260.99</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="gradient-boosting">
<h2>10.6 Gradient Boosting<a class="headerlink" href="#gradient-boosting" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># model</span>
<span class="n">model_GBDT</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor</span><span class="p">()</span>

<span class="c1">#performance</span>

<span class="n">model_GBDT</span> <span class="o">=</span> <span class="n">timeSeries_CV</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span> <span class="s1">&#39;GradienteBoost Regressor&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span> <span class="n">model_GBDT</span><span class="p">,</span> <span class="n">kfold</span><span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">model_GBDT</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model Name</th>
      <th>MAE CV</th>
      <th>MAPE CV</th>
      <th>RMSE CV</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>GradienteBoost Regressor</td>
      <td>1785.87 +/- 82.54</td>
      <td>0.28 +/- 0.01</td>
      <td>2570.45 +/- 119.73</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="compare-model-s-performance">
<h2>10.6 Compare Model’s Performance<a class="headerlink" href="#compare-model-s-performance" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modelling_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span> <span class="p">[</span><span class="n">lr_result</span><span class="p">,</span> <span class="n">lrr_result</span><span class="p">,</span> <span class="n">rf_result</span><span class="p">,</span> <span class="n">xgb_result</span><span class="p">,</span> <span class="n">model_GBDT</span><span class="p">]</span> <span class="p">)</span>
<span class="n">modelling_result</span> <span class="o">=</span> <span class="n">modelling_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span> <span class="s1">&#39;RMSE CV&#39;</span> <span class="p">)</span>

<span class="c1"># salvar tabela  para documentação</span>

<span class="n">modelling_result</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;Relatorios/modelling_result.csv&#39;</span><span class="p">)</span>
<span class="n">modelling_result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model Name</th>
      <th>MAE CV</th>
      <th>MAPE CV</th>
      <th>RMSE CV</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>XGBoost Regressor</td>
      <td>1096.91 +/- 157.56</td>
      <td>0.16 +/- 0.02</td>
      <td>1603.58 +/- 260.99</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Random Forest Regressor</td>
      <td>1042.48 +/- 232.24</td>
      <td>0.15 +/- 0.03</td>
      <td>1637.8 +/- 412.93</td>
    </tr>
    <tr>
      <th>0</th>
      <td>GradienteBoost Regressor</td>
      <td>1785.87 +/- 82.54</td>
      <td>0.28 +/- 0.01</td>
      <td>2570.45 +/- 119.73</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Linear Regression - Lasso</td>
      <td>1990.09 +/- 78.8</td>
      <td>0.32 +/- 0.01</td>
      <td>2830.26 +/- 141.18</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Linear Regression</td>
      <td>1991.32 +/- 79.87</td>
      <td>0.32 +/- 0.01</td>
      <td>2834.85 +/- 148.89</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="hyperparameter-tuning">
<h1>11. Hyperparameter Tuning<a class="headerlink" href="#hyperparameter-tuning" title="Permalink to this heading">#</a></h1>
<section id="determinando-o-tamanho-da-amostra">
<h2>11.1.1 Determinando o Tamanho da Amostra<a class="headerlink" href="#determinando-o-tamanho-da-amostra" title="Permalink to this heading">#</a></h2>
<p>Para finalizar a criação da amostra, optarei por selecionar as instâncias correspondentes ao último ano presente no conjunto de dados de treinamento, reduzindo assim o tempo de processamento.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">amostra</span> <span class="o">=</span> <span class="n">df8</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># Excluindo colunas </span>

<span class="n">cols_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;week_of_year&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day_of_week&#39;</span><span class="p">,</span> <span class="s1">&#39;promo_since&#39;</span><span class="p">,</span> <span class="s1">&#39;competition_since&#39;</span><span class="p">,</span> <span class="s1">&#39;year_week&#39;</span> <span class="p">]</span>
<span class="n">amostra</span> <span class="o">=</span> <span class="n">amostra</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span> <span class="n">cols_drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>

<span class="c1"># training dataset</span>
<span class="n">X_amostra</span> <span class="o">=</span> <span class="n">amostra</span><span class="p">[</span><span class="n">amostra</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;2014-07-31&#39;</span><span class="p">]</span>
<span class="n">y_amostra</span> <span class="o">=</span> <span class="n">X_amostra</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span>

<span class="c1">#Features selecionadas</span>

<span class="n">X_amostra</span> <span class="o">=</span> <span class="n">X_amostra</span><span class="p">[</span><span class="n">cols_select</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Tamanho da amostra </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_amostra</span><span class="p">)</span><span class="si">}</span><span class="s1">, o que representa </span><span class="si">{</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_amostra</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tamanho da amostra 315540, o que representa 37.37%
</pre></div>
</div>
</div>
</div>
</section>
<section id="hyperparameter-tuning-com-bayesiansearchcv">
<h2>11.1.2 Hyperparameter Tuning com BayesianSearchCV<a class="headerlink" href="#hyperparameter-tuning-com-bayesiansearchcv" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Registrar o tempo antes de executar as operações</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1">#model</span>

<span class="n">xgb_bay</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">()</span>

<span class="c1"># Bayesian</span>
<span class="n">n_iter</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># Criar objeto TimeSeriesSplit para validação cruzada</span>
<span class="n">tscv</span> <span class="o">=</span> <span class="n">TimeSeriesSplit</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> 
            <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
            <span class="s1">&#39;subsample&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)}</span>


<span class="n">reg_bay</span> <span class="o">=</span>  <span class="n">BayesSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span> <span class="n">xgb_bay</span><span class="p">,</span>
                    <span class="n">search_spaces</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
                    <span class="n">n_iter</span><span class="o">=</span><span class="n">n_iter</span><span class="p">,</span>
                    <span class="n">cv</span><span class="o">=</span><span class="n">tscv</span><span class="p">,</span>
                    <span class="n">n_jobs</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                    <span class="n">scoring</span><span class="o">=</span> <span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span>
                    <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">print_status</span><span class="p">(</span><span class="n">optimal_result</span><span class="p">):</span>
    
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;best score test: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">optimal_result</span><span class="p">[</span><span class="s2">&quot;fun&quot;</span><span class="p">],</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s1"> | learning_rate: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">optimal_result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s1">,max_depth: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">optimal_result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s1">,n_estimators: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">optimal_result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="si">}</span><span class="s1">,subsample: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">optimal_result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s1"> | n_iter: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">optimal_result</span><span class="p">[</span><span class="s2">&quot;x_iters&quot;</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>
    
<span class="n">model_bay</span> <span class="o">=</span> <span class="n">reg_bay</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_amostra</span><span class="p">,</span> <span class="n">y_amostra</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">print_status</span><span class="p">)</span>


<span class="c1"># Calcular o tempo gasto</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Imprimir o tempo gasto</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tempo gasto: </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> segundos&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>best score test: 0.24 | learning_rate: 0.1788,max_depth: 11,n_estimators: 361,subsample: 0.5171 | n_iter: 1
best score test: 0.24 | learning_rate: 0.1788,max_depth: 11,n_estimators: 361,subsample: 0.5171 | n_iter: 2
best score test: 0.24 | learning_rate: 0.1788,max_depth: 11,n_estimators: 361,subsample: 0.5171 | n_iter: 3
best score test: 0.2371 | learning_rate: 0.1344,max_depth: 10,n_estimators: 592,subsample: 0.6745 | n_iter: 4
best score test: 0.2248 | learning_rate: 0.0996,max_depth: 11,n_estimators: 354,subsample: 0.7053 | n_iter: 5
best score test: 0.2248 | learning_rate: 0.0996,max_depth: 11,n_estimators: 354,subsample: 0.7053 | n_iter: 6
best score test: 0.2248 | learning_rate: 0.0996,max_depth: 11,n_estimators: 354,subsample: 0.7053 | n_iter: 7
best score test: 0.2248 | learning_rate: 0.0996,max_depth: 11,n_estimators: 354,subsample: 0.7053 | n_iter: 8
best score test: 0.2248 | learning_rate: 0.0996,max_depth: 11,n_estimators: 354,subsample: 0.7053 | n_iter: 9
best score test: 0.2248 | learning_rate: 0.0996,max_depth: 11,n_estimators: 354,subsample: 0.7053 | n_iter: 10
best score test: 0.2248 | learning_rate: 0.0996,max_depth: 11,n_estimators: 354,subsample: 0.7053 | n_iter: 11
best score test: 0.2248 | learning_rate: 0.0996,max_depth: 11,n_estimators: 354,subsample: 0.7053 | n_iter: 12
best score test: 0.223 | learning_rate: 0.0904,max_depth: 8,n_estimators: 300,subsample: 0.9688 | n_iter: 13
best score test: 0.223 | learning_rate: 0.0904,max_depth: 8,n_estimators: 300,subsample: 0.9688 | n_iter: 14
best score test: 0.223 | learning_rate: 0.0904,max_depth: 8,n_estimators: 300,subsample: 0.9688 | n_iter: 15
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 16
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 17
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 18
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 19
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 20
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 21
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 22
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 23
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 24
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 25
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 26
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 27
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 28
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 29
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 30
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 31
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 32
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 33
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 34
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 35
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 36
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 37
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 38
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 39
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 40
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 41
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 42
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 43
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 44
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 45
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 46
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 47
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 48
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 49
best score test: 0.2185 | learning_rate: 0.0744,max_depth: 9,n_estimators: 300,subsample: 0.4575 | n_iter: 50
Tempo gasto: 18258.88 segundos
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Salvar o estudo para documentação</span>

<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model_bay</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span>  <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;C:/Users/55329/Documents/3.Repos/Rossmann-sales/Relatorios/model_bay.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skopt.plots</span> <span class="kn">import</span> <span class="n">plot_convergence</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plot_convergence</span><span class="p">(</span><span class="n">model_bay</span><span class="o">.</span><span class="n">optimizer_results_</span><span class="p">)</span>

<span class="c1"># Personalize o título</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Convergência da Otimização Bayesiana&quot;</span><span class="p">)</span>

<span class="c1"># Personalize os rótulos dos eixos</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Número de Avaliações&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Melhor Valor da Função Objetivo&quot;</span><span class="p">)</span>

<span class="c1"># Exibe o gráfico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/801287209df471f12f7a1ef63902059831b7fd3977b4d4cd9c7ba110c74b703e.png" src="_images/801287209df471f12f7a1ef63902059831b7fd3977b4d4cd9c7ba110c74b703e.png" />
</div>
</div>
</section>
<section id="parametros">
<h2>11.1.3 Parâmetros<a class="headerlink" href="#parametros" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_bay</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;Relatorios\model_bay.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
<span class="n">model_bay</span><span class="o">.</span><span class="n">best_params_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OrderedDict([(&#39;learning_rate&#39;, 0.07441915669614352),
             (&#39;max_depth&#39;, 9),
             (&#39;n_estimators&#39;, 300),
             (&#39;subsample&#39;, 0.4574514273099535)])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span>  <span class="mf">0.075</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="s1">&#39;subsample&#39;</span><span class="p">:</span> <span class="mf">0.46</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelo-final">
<h2>11.3. Modelo Final<a class="headerlink" href="#modelo-final" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_bay_best</span> <span class="o">=</span> <span class="n">model_bay</span><span class="o">.</span><span class="n">best_estimator_</span>

<span class="n">result_model_bay_best</span> <span class="o">=</span> <span class="n">timeSeries_CV</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span> <span class="s1">&#39;bayes best&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span> <span class="n">model_bay_best</span><span class="p">,</span> <span class="n">kfold</span><span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_model_bay_best</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model Name</th>
      <th>MAE CV</th>
      <th>MAPE CV</th>
      <th>RMSE CV</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bayes best</td>
      <td>1022.37 +/- 153.25</td>
      <td>0.16 +/- 0.02</td>
      <td>1477.74 +/- 253.24</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Salvar o modelo</span>

<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model_bay_best</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span>  <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;C:/Users/55329/Documents/3.Repos/Rossmann-sales/model/model_xgb_tuned.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="performance">
<h1>12. Performance<a class="headerlink" href="#performance" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_bay_best</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">],</span>
                                    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">],</span>
                                    <span class="n">n_estimators</span> <span class="o">=</span> <span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">],</span>
                                    <span class="n">subsample</span> <span class="o">=</span> <span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;subsample&#39;</span><span class="p">]</span>
                                                        <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">cols_select</span><span class="p">],</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># prediction </span>
<span class="n">yhat_xgb_tuned</span> <span class="o">=</span> <span class="n">model_bay_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="n">cols_select</span><span class="p">])</span>

<span class="c1">#performance FINAL</span>

<span class="n">xgb_tuned_result</span> <span class="o">=</span> <span class="n">ml_error</span><span class="p">(</span><span class="s1">&#39;XGBRegressor Tuned&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">y_test</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">yhat_xgb_tuned</span><span class="p">))</span>
<span class="n">xgb_tuned_result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model Name</th>
      <th>MAE</th>
      <th>MAPE</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>XGBRegressor Tuned</td>
      <td>720.504937</td>
      <td>0.105523</td>
      <td>1045.166501</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df12</span> <span class="o">=</span> <span class="n">df9</span><span class="p">[</span><span class="n">df9</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s1">&#39;2015-06-19&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1">#Rescale</span>

<span class="n">df12</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
<span class="n">df12</span><span class="p">[</span><span class="s1">&#39;predictions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">yhat_xgb_tuned</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="bussines-performance">
<h2>12.1 Bussines Performance<a class="headerlink" href="#bussines-performance" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sum of predictions</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_absolute_percentage_error</span>         

<span class="n">df121</span> <span class="o">=</span> <span class="n">df12</span><span class="p">[[</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;predictions&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;store&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span><span class="s1">&#39;mean&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df121</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df121</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df121</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;&#39;</span><span class="p">:</span><span class="s1">&#39;store&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span> <span class="p">:</span> <span class="s1">&#39;total_prediction&#39;</span><span class="p">,</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="s1">&#39;mean_prediction&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1">#MAE and MAPE</span>
<span class="n">df12_aux1</span> <span class="o">=</span> <span class="n">df12</span><span class="p">[[</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">,</span><span class="s1">&#39;predictions&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;store&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;predictions&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;MAE&#39;</span><span class="p">})</span>
<span class="n">df12_aux2</span> <span class="o">=</span> <span class="n">df12</span><span class="p">[[</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;sales&#39;</span><span class="p">,</span><span class="s1">&#39;predictions&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span> <span class="s1">&#39;store&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mean_absolute_percentage_error</span><span class="p">(</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;predictions&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;MAPE&#39;</span><span class="p">})</span>

<span class="c1">#merge</span>

<span class="n">df12_aux3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span> <span class="n">df12_aux1</span><span class="p">,</span> <span class="n">df12_aux2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;store&#39;</span> <span class="p">)</span>
<span class="n">df122</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span> <span class="n">df121</span><span class="p">,</span> <span class="n">df12_aux3</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;store&#39;</span> <span class="p">)</span>



<span class="c1"># Scenarios</span>

<span class="n">df122</span><span class="p">[</span><span class="s1">&#39;worst_scenario_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df122</span><span class="p">[</span><span class="s1">&#39;total_prediction&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df122</span><span class="p">[</span><span class="s1">&#39;MAE&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">42</span>
<span class="n">df122</span><span class="p">[</span><span class="s1">&#39;best_scenario_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df122</span><span class="p">[</span><span class="s1">&#39;total_prediction&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df122</span><span class="p">[</span><span class="s1">&#39;MAE&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">42</span>

<span class="n">df122</span><span class="p">[</span><span class="s1">&#39;worst_scenario_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df122</span><span class="p">[</span><span class="s1">&#39;mean_prediction&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df122</span><span class="p">[</span><span class="s1">&#39;MAE&#39;</span><span class="p">]</span>
<span class="n">df122</span><span class="p">[</span><span class="s1">&#39;best_scenario_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df122</span><span class="p">[</span><span class="s1">&#39;mean_prediction&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df122</span><span class="p">[</span><span class="s1">&#39;MAE&#39;</span><span class="p">]</span>

<span class="n">df122</span><span class="p">[</span><span class="s1">&#39;absolute_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df122</span><span class="p">[</span><span class="s1">&#39;MAE&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">42</span>
<span class="c1">#order columns</span>

<span class="c1"># Visão total</span>
<span class="n">df123</span> <span class="o">=</span> <span class="n">df122</span><span class="p">[[</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;total_prediction&#39;</span><span class="p">,</span> <span class="s1">&#39;worst_scenario_total&#39;</span><span class="p">,</span> <span class="s1">&#39;best_scenario_total&#39;</span><span class="p">,</span> <span class="s1">&#39;absolute_error&#39;</span> <span class="p">,</span><span class="s1">&#39;MAPE&#39;</span><span class="p">]]</span>

<span class="c1">#visão diaria</span>

<span class="n">df124</span> <span class="o">=</span> <span class="n">df122</span><span class="p">[[</span><span class="s1">&#39;store&#39;</span><span class="p">,</span><span class="s1">&#39;mean_prediction&#39;</span><span class="p">,</span> <span class="s1">&#39;worst_scenario_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;best_scenario_mean&#39;</span><span class="p">,</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<section id="erro-percentual-medio-de-cada-loja">
<h3>12.1.1 Erro percentual medio de cada loja<a class="headerlink" href="#erro-percentual-medio-de-cada-loja" title="Permalink to this heading">#</a></h3>
<p>Há lojas com erros muito acima da média, podendo ultrapassar os 60%, conforme evidenciado no primeiro gráfico desta seção. No segundo conjunto de gráficos, observamos que aproximadamente 700 lojas apresentam erros de até 10%, o que é um desempenho excelente para o nosso problema de negócio. Além disso, temos um grupo com pouco mais de 300 lojas, nas quais os erros variam entre 10% e 15%, enquanto as demais lojas apresentam erros superiores a 20%.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erro percentual medio de cada loja</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Distribuição do Erro Percentual medio de cada loja&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;MAPE&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/89ae78a2665c897b9476e7b33b798a7967cd36068bcca306881a7312067f9c52.png" src="_images/89ae78a2665c897b9476e7b33b798a7967cd36068bcca306881a7312067f9c52.png" />
</div>
</div>
</section>
<section id="distribuicao-e-analise-de-outiler-no-erro-do-modelo">
<h3>12.1.2 Distribuição e Analise de Outiler no erro do modelo<a class="headerlink" href="#distribuicao-e-analise-de-outiler-no-erro-do-modelo" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1">#Titulo</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Distribuição e Analise de Outiler no erro do modelo&#39;</span><span class="p">)</span>

<span class="c1"># Boxplot</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">df122</span><span class="p">[</span><span class="s1">&#39;MAPE&#39;</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Boxplot&#39;</span><span class="p">)</span>
<span class="c1"># Histograma</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df122</span><span class="p">[</span><span class="s1">&#39;MAPE&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histograma&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d799060dd3df4979c36cad79ea948fd4bbab4a50bcd753a10cec0188d66239c1.png" src="_images/d799060dd3df4979c36cad79ea948fd4bbab4a50bcd753a10cec0188d66239c1.png" />
</div>
</div>
</section>
</section>
<section id="total-performance">
<h2>12.2 Total Performance<a class="headerlink" href="#total-performance" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df125</span> <span class="o">=</span> <span class="n">df122</span><span class="p">[[</span><span class="s1">&#39;total_prediction&#39;</span><span class="p">,</span> <span class="s1">&#39;worst_scenario_total&#39;</span><span class="p">,</span> <span class="s1">&#39;best_scenario_total&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;Scenario&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;Values&#39;</span><span class="p">})</span>
<span class="n">df125</span><span class="p">[</span><span class="s1">&#39;Values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df125</span><span class="p">[</span><span class="s1">&#39;Values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="s1">&#39;R$</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span> <span class="p">)</span>
<span class="n">df125</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Scenario</th>
      <th>Values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>total_prediction</td>
      <td>R$283,511,104.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>worst_scenario_total</td>
      <td>R$249,610,248.61</td>
    </tr>
    <tr>
      <th>2</th>
      <td>best_scenario_total</td>
      <td>R$317,411,923.22</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="machine-learning-performance">
<h2>12.3 Machine Learning Performance<a class="headerlink" href="#machine-learning-performance" title="Permalink to this heading">#</a></h2>
<p>Ao analisar os dois primeiros gráficos abaixo, é evidente que o modelo é capaz de capturar o comportamento cíclico das vendas, embora apresente alguns períodos com taxas de erro mais elevadas.</p>
<p>Já nos dois últimos gráficos, a distribuição das previsões parece seguir uma distribuição normal. No entanto, é notável que tanto a kurtosis (43.03) quanto a Skewness (2.31) apresentam valores elevados. Além disso, ao examinarmos o quarto gráfico, onde estão plotados os erros, podemos observar que muitas previsões estão fora dos limites do “bigode do boxplot”, indicado por uma linha tracejada, e também podemos identificar valores extremos destacados em vermelho.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df12</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df12</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df12</span><span class="p">[</span><span class="s1">&#39;predictions&#39;</span><span class="p">]</span>
<span class="n">df12</span><span class="p">[</span><span class="s1">&#39;error_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df12</span><span class="p">[</span><span class="s1">&#39;predictions&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df12</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df12</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SALES&#39;</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;predictions&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df12</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PREDICTIONS&#39;</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;error_rate&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df12</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
<span class="c1"># Cálculo da skewness e kurtosis</span>
<span class="n">skewness</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">df12</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
<span class="n">kurtosis</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">(</span><span class="n">df12</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>

<span class="c1"># Texto para exibir as informações de skewness e kurtosis</span>
<span class="n">info_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Skewness: </span><span class="si">{</span><span class="n">skewness</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">Kurtosis: </span><span class="si">{</span><span class="n">kurtosis</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="n">info_text</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
<span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span> <span class="n">df12</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>



<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span>  <span class="n">df12</span><span class="p">[</span><span class="s1">&#39;predictions&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">df12</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="p">)</span>

<span class="c1"># Calcular os quartis</span>
<span class="n">q1</span> <span class="o">=</span> <span class="n">df12</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">q3</span> <span class="o">=</span> <span class="n">df12</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>

<span class="c1"># Calcular a amplitude interquartil (IQR)</span>
<span class="n">iqr</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span>

<span class="c1"># Calcular os limites dos bigodes</span>
<span class="n">lower_whisker</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span>
<span class="n">upper_whisker</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span>

<span class="c1"># Adicionar as linhas dos limites dos bigodes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">upper_whisker</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Upper Whisker&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">lower_whisker</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lower Whisker&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Upper Whisker&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="n">lower_whisker</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">30000</span><span class="p">,</span> <span class="n">upper_whisker</span> <span class="o">+</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Lower Whisker&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="n">lower_whisker</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">30000</span><span class="p">,</span> <span class="n">lower_whisker</span> <span class="o">-</span> <span class="mi">1100</span><span class="p">))</span>

<span class="c1"># Coordenadas do retângulo</span>
<span class="n">x_rect</span> <span class="o">=</span> <span class="mi">11000</span>
<span class="n">y_rect</span> <span class="o">=</span> <span class="mi">6000</span>
<span class="n">width</span> <span class="o">=</span> <span class="mi">27000</span>
<span class="n">height</span> <span class="o">=</span> <span class="mi">8000</span>
<span class="n">angle</span> <span class="o">=</span> <span class="mi">90</span>  <span class="c1"># ângulo de rotação em graus</span>

<span class="c1"># Criar o retângulo inclinado</span>
<span class="n">rectangle</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x_rect</span><span class="p">,</span> <span class="n">y_rect</span><span class="p">),</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

<span class="c1"># Adicionar o retângulo ao gráfico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rectangle</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.patches.Rectangle at 0x17f86803910&gt;
</pre></div>
</div>
<img alt="_images/47a0d8ac55b0a63d1a27fa186f533c72dfaff5da7b95a38866c086be15571508.png" src="_images/47a0d8ac55b0a63d1a27fa186f533c72dfaff5da7b95a38866c086be15571508.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="deploy">
<h1>13. Deploy<a class="headerlink" href="#deploy" title="Permalink to this heading">#</a></h1>
<section id="rossmann-class">
<h2>13.1 Rossmann Class<a class="headerlink" href="#rossmann-class" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">inflection</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">pickle</span>



<span class="k">class</span> <span class="nc">Rossmann</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">home_path</span> <span class="o">=</span> <span class="s1">&#39;/Users/55329/Documents/3.Repos/Rossmann-sales/&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">competition_distance_scaler</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_path</span> <span class="o">+</span> <span class="s1">&#39;parameter/competition_distance_scaler.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">competition_time_month_scaler</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_path</span> <span class="o">+</span> <span class="s1">&#39;parameter/competition_time month_scaler.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">promo_time_month_scaler</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_path</span> <span class="o">+</span> <span class="s1">&#39;parameter/promo_time_week_scaler.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">year_scaler</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_path</span> <span class="o">+</span> <span class="s1">&#39;parameter/year_scaler.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store_type_encoder</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_path</span> <span class="o">+</span> <span class="s1">&#39;parameter/store_type_encoder.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        
        
    <span class="k">def</span> <span class="nf">data_cleaning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        
        <span class="c1">## 1.1 RENAME COLUMNS</span>
        <span class="n">cols_old</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Store&#39;</span><span class="p">,</span> <span class="s1">&#39;DayOfWeek&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Open&#39;</span><span class="p">,</span> <span class="s1">&#39;Promo&#39;</span><span class="p">,</span> <span class="s1">&#39;StateHoliday&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;SchoolHoliday&#39;</span><span class="p">,</span> <span class="s1">&#39;StoreType&#39;</span><span class="p">,</span> <span class="s1">&#39;Assortment&#39;</span><span class="p">,</span> <span class="s1">&#39;CompetitionDistance&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;CompetitionOpenSinceMonth&#39;</span><span class="p">,</span> <span class="s1">&#39;CompetitionOpenSinceYear&#39;</span><span class="p">,</span> <span class="s1">&#39;Promo2&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Promo2SinceWeek&#39;</span><span class="p">,</span> <span class="s1">&#39;Promo2SinceYear&#39;</span><span class="p">,</span> <span class="s1">&#39;PromoInterval&#39;</span><span class="p">]</span>

        <span class="n">snakecase</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">inflection</span><span class="o">.</span><span class="n">underscore</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">cols_new</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">snakecase</span><span class="p">,</span> <span class="n">cols_old</span><span class="p">))</span>

        <span class="c1">#rename</span>

        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols_new</span>

        <span class="c1">## 1.5 Fillout NA</span>
        <span class="c1">#competition_distance</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;competition_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;competition_distance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">200000.0</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>

        <span class="c1">#competition_open_since_month    </span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;competition_open_since_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;competition_open_since_month&#39;</span> <span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">month</span> 
                                                        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;competition_open_since_month&#39;</span><span class="p">]</span> <span class="p">)</span> 
                                                        <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;competition_open_since_month&#39;</span><span class="p">],</span>
                                                        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>

        <span class="c1">#competition_open_since_year     </span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;competition_open_since_year&#39;</span> <span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">year</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>                       

        <span class="c1">#promo2_since_week              </span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;promo2_since_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;promo2_since_week&#39;</span> <span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">week</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;promo2_since_week&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;promo2_since_week&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>

        <span class="c1">#promo2_since_year               </span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;promo2_since_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;promo2_since_year&#39;</span> <span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">year</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;promo2_since_year&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="n">x</span> <span class="p">[</span><span class="s1">&#39;promo2_since_year&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1">#promo_interval </span>
        <span class="n">month_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;Jan&#39;</span><span class="p">,</span>  <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;Fev&#39;</span><span class="p">,</span>  <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span>  <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span>  <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span>  <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span>  <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39;Jul&#39;</span><span class="p">,</span>  <span class="mi">8</span><span class="p">:</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span>  <span class="mi">9</span><span class="p">:</span> <span class="s1">&#39;Sept&#39;</span><span class="p">,</span>  <span class="mi">10</span><span class="p">:</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">:</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span> <span class="s1">&#39;Dec&#39;</span><span class="p">}</span>

        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;promo_interval&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;month_map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">month_map</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_promo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;promo_interval&#39;</span><span class="p">,</span> <span class="s1">&#39;month_map&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;promo_interval&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;month_map&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;promo_interval&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
        <span class="c1">## 1.6 Change Data Types</span>
        <span class="c1"># competiton</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;competition_open_since_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;competition_open_since_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">int</span> <span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">int</span> <span class="p">)</span>
            
        <span class="c1"># promo2</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;promo2_since_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;promo2_since_week&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">int</span> <span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;promo2_since_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;promo2_since_year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">int</span> <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">df</span>
        
    <span class="k">def</span> <span class="nf">feature_engineering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        
        <span class="c1">### 2.4. Feature Engineering</span>
        <span class="c1"># year</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>

        <span class="c1"># month</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>

        <span class="c1"># day</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>

        <span class="c1"># week of year</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;week_of_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()</span><span class="o">.</span><span class="n">week</span>

        <span class="c1"># year week</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;year_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span> <span class="s1">&#39;%Y-%W&#39;</span> <span class="p">)</span>

        <span class="c1"># competition since</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;competition_since&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span> <span class="n">year</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;competition_open_since_year&#39;</span><span class="p">],</span> <span class="n">month</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;competition_open_since_month&#39;</span><span class="p">],</span><span class="n">day</span><span class="o">=</span><span class="mi">1</span> <span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;competition_time_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;competition_since&#39;</span><span class="p">]</span> <span class="p">)</span><span class="o">/</span><span class="mi">30</span> <span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">days</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">int</span> <span class="p">)</span>

        <span class="c1"># promo since</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;promo_since&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;promo2_since_year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">str</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;promo2_since_week&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">str</span> <span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;promo_since&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;promo_since&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;-1&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y-%W-%w&#39;</span> <span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span> <span class="n">days</span><span class="o">=</span><span class="mi">7</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;promo_since&#39;</span><span class="p">]</span> <span class="p">)</span><span class="o">/</span><span class="mi">7</span> <span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">days</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span> <span class="nb">int</span> <span class="p">)</span>

        <span class="c1"># assortment</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;basic&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span> <span class="k">else</span> <span class="s1">&#39;extra&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span> <span class="k">else</span> <span class="s1">&#39;extended&#39;</span> <span class="p">)</span>

        <span class="c1"># state holiday</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;public_holiday&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span> <span class="k">else</span> <span class="s1">&#39;easter_holiday&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span> <span class="k">else</span> <span class="s1">&#39;christmas&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span> <span class="k">else</span> <span class="s1">&#39;regular_day&#39;</span> <span class="p">)</span>

        <span class="c1">## 3.0. PASSO 03 - FILTRAGEM DE VARIÁVEIS</span>
        <span class="c1">### 3.1. Filtragem das Linhas</span>
        <span class="c1"># Quero apenas dados onde a loja esta aberta e que valor de vendas seja maior que 0</span>

        <span class="c1">### 3.2. Selecao das Colunas</span>
        
        <span class="c1"># Excluir colunas na qual eu não terei durante o processo de previsão</span>
        <span class="n">cols_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;promo_interval&#39;</span><span class="p">,</span> <span class="s1">&#39;month_map&#39;</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span> <span class="n">cols_drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>
    
    <span class="k">def</span> <span class="nf">data_preparation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        
        <span class="c1">## 5.1 Rescaling</span>

        <span class="c1"># competition distance</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;competition_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">competition_distance_scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;competition_distance&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="c1"># competition time month</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;competition_time_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">competition_time_month_scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;competition_time_month&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span> <span class="p">)</span>

        <span class="c1"># promo time week</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">promo_time_month_scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;promo_time_week&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span> <span class="p">)</span>

        <span class="c1"># year</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">year_scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span> <span class="p">)</span>

        <span class="c1">## 5.2 Transformacao</span>
        <span class="c1">### 5.2.1 Encoding</span>
        
        <span class="c1"># state_holiday - One Hot Encoding</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span> <span class="n">df</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state_holiday&#39;</span><span class="p">]</span> <span class="p">)</span>

        <span class="c1"># store_type - Label Encoding</span>
        
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;store_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_type_encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;store_type&#39;</span><span class="p">]</span> <span class="p">)</span>

        <span class="c1"># assortment - Ordinal Encoding</span>
        <span class="n">assortment_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;basic&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="s1">&#39;extra&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;extended&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;assortment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="n">assortment_dict</span> <span class="p">)</span>
        
        <span class="c1">### 5.2.2 Response Variable Transformation</span>
        
        <span class="c1"># Transformação Logaritmica</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">])</span>
        <span class="c1">### 5.2.3 Nature Transformation</span>
        <span class="c1"># day of week</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day_of_week_sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day_of_week_cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c1"># month</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;month_sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">12</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;month_cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">12</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c1"># day </span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day_sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">30</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day_cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">30</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c1"># week of year</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;week_of_year_sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;week_of_year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">52</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;week_of_year_cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;week_of_year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">52</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">df</span>
    
    <span class="k">def</span> <span class="nf">get_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">original_data</span><span class="p">,</span> <span class="n">test_data</span><span class="p">):</span>
        
        <span class="c1">#prediction</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
        
        <span class="c1"># junção da predição com o real</span>
        
        <span class="n">original_data</span><span class="p">[</span><span class="s1">&#39;prediction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">original_data</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span> <span class="s1">&#39;records&#39;</span><span class="p">,</span> <span class="n">date_format</span><span class="o">=</span> <span class="s1">&#39;iso&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="api-handler">
<h2>13.2 API HANDLER<a class="headerlink" href="#api-handler" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># imports</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span> <span class="p">,</span> <span class="n">Response</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">api.rossmann.Rossmann</span> <span class="kn">import</span> <span class="n">Rossmann</span>

<span class="c1"># loading model</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;C:/Users/55329/Documents/3.Repos/Rossmann-sales/model/model_xgb_tuned.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>

<span class="c1"># initialize API</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/rossmann/predict&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">rossmann_predict</span><span class="p">():</span>
    <span class="n">test_json</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">test_json</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test_json</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="c1"># Uma linha unica </span>
            <span class="n">test_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">test_json</span> <span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            
        <span class="k">else</span><span class="p">:</span> <span class="c1"># Multiplas linhas</span>
            <span class="n">test_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">test_json</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span> <span class="n">test_json</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            
        <span class="c1"># Instaciar classe Rosmann</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Rossmann</span><span class="p">()</span>
        
        <span class="c1"># data cleaning</span>
        <span class="n">df1</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">data_cleaning</span><span class="p">(</span><span class="n">test_raw</span><span class="p">)</span>
        
        <span class="c1"># feature engineering </span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">feature_engineering</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
        
        <span class="c1"># data prepation</span>
        <span class="n">df3</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">data_preparation</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
        
        <span class="c1"># prediction</span>
        <span class="n">df_response</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">get_prediction</span><span class="p">(</span><span class="n">model</span><span class="o">=</span> <span class="n">model</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">df3</span><span class="p">,</span> <span class="n">original_data</span><span class="o">=</span><span class="n">test_raw</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">df_response</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="api-tester">
<h2>13.3 API Tester<a class="headerlink" href="#api-tester" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># loading test dataset</span>

<span class="n">df_test_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/Users/55329/Documents/3.Repos/Rossmann-sales/data/test.csv&#39;</span><span class="p">)</span>
<span class="n">df_store_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;C:/Users/55329/Documents/3.Repos/Rossmann-sales/data/store.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># merge test dataset + store</span>

<span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_test_raw</span><span class="p">,</span> <span class="n">df_store_raw</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;Store&#39;</span><span class="p">)</span>

<span class="c1"># Choose store for prediction </span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;Store&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">22</span><span class="p">])]</span>

<span class="c1"># Remove closed days</span>

<span class="n">df_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;Open&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="o">~</span><span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;Open&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Id&#39;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dft</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;Store&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">])]</span>

<span class="n">dft</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(40, 16)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert Dataframe to json</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">df_test</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span> <span class="s1">&#39;records&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># API Call</span>

<span class="c1">#url = &#39;http://localhost:5000/rossmann/predict&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://rossmann-api-45ni.onrender.com/rossmann/predict&#39;</span>
<span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">header</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Status Code </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Status Code 200
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span><span class="p">[[</span><span class="s1">&#39;store&#39;</span><span class="p">,</span><span class="s1">&#39;prediction&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;store&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">d2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>store</th>
      <th>prediction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>22</td>
      <td>179267.744141</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="conclusao">
<h1>14. Conclusão<a class="headerlink" href="#conclusao" title="Permalink to this heading">#</a></h1>
<p>Neste estágio do projeto, podemos tirar algumas conclusões importantes. É evidente que o modelo não apresenta um desempenho uniforme para todas as lojas. Nesse sentido, sugiro ao CFO que priorize um levantamento das 700 lojas que demonstraram bom desempenho até o momento.</p>
<p>Para o próximo passo, nossa recomendação é que concentremos nossa análise nas demais lojas. Isso nos permitirá alcançar resultados mais adequados para prever as vendas das próximas 6 semanas. A partir dessas informações sólidas, o CFO poderá tomar decisões embasadas para elaborar os orçamentos.</p>
<p>Essa abordagem direcionada nos permitirá otimizar nossos recursos e concentrar nossos esforços onde têm maior probabilidade de impacto positivo.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="proximos-passos">
<h1>15. Próximos Passos<a class="headerlink" href="#proximos-passos" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>Realizar uma investigação detalhada para identificar as causas das previsões inadequadas em algumas lojas.</p></li>
<li><p>Explorar a inclusão de diferentes algoritmos durante a próxima fase de treinamento, com o objetivo de aprimorar a precisão das previsões.</p></li>
<li><p>Identificar e criar novas variáveis (features) que possam contribuir para melhorar o desempenho do modelo atual e futuros modelos de previsão.</p></li>
<li><p>Criar novas <em>Features</em> para tentar melhorar a perfomance do modelo atual e de modelos futuros.</p></li>
<li><p>Fazer novos levantamentos de hipóteses afim de buscar novos insights e conhecimento de negócio.</p></li>
</ul>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="README.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Readme</p>
      </div>
    </a>
    <a class="right-next"
       href="rossmann.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">api.rossmann.Rossmann</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Apresentação do Projeto</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#bussines">1. Bussines</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contexto">1.1 Contexto</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#desafio">1.2 Desafio</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problema">Problema</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#causas">Causas</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">2. Configuration</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">2.1 Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">2.2 Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maquina">2.3 Máquina</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuracao-de-vizualizacao">2.4 Configuração de Vizualização</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-load">3. Data Load</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">3. Data Preprocessing</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rename-columns">3.1 Rename Columns</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-dimensions">3.2 Data Dimensions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-types">3.3 Data Types</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-na">3.4 Check NA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fillout-na">3.5 Fillout NA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#change-data-types">3.6 Change Data Types</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-description">4. Data Description</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-atributes">4.1 Numerical Atributes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-atributes">4.2. Categorical Atributes</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engeneering">5. Feature Engeneering</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mapa-mental-de-hipoteses">5.1 Mapa Mental de Hipoteses</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#criacao-das-hipoteses">5.2. Criaçao das Hipoteses</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hipoteses-loja">5.2.1. Hipoteses Loja</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hipoteses-produto">5.2.2. Hipoteses Produto</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hipoteses-tempo">5.2.3. Hipoteses Tempo</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lista-final-de-hipoteses">2.3. Lista Final de Hipóteses</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering">5.4. Feature Engineering</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#filtragem-das-variaveis">6. Filtragem das Variaveis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filtragem-das-linhas">6.1. Filtragem das Linhas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#selecao-das-colunas">6.2. Selecao das Colunas</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-data-analysis">7. Exploratory Data Analysis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-univariada">7.1. Analise Univariada</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variavel-target">7.1.1 Variavel Target</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variaveis-numerica">7.1.2 Variaveis Numérica</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variaveis-categoricas">7.1.2 Variaveis Categóricas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-bivariada">7.1. Analise Bivariada</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h1-lojas-com-maior-sortimentos-deveriam-na-media-vender-mais"><strong>H1.</strong> Lojas com maior sortimentos deveriam na média vender mais.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h2-lojas-com-competidores-mais-proximos-na-media-deveriam-vender-menos"><strong>H2.</strong> Lojas com competidores mais próximos na média deveriam vender menos.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h3-lojas-com-competidores-a-mais-tempo-deveriam-vender-mais"><strong>H3.</strong> Lojas com competidores à mais tempo deveriam vender mais.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h4-lojas-com-promocoes-ativas-por-mais-tempo-deveriam-vender-mais"><strong>H4.</strong> Lojas com promoções ativas por mais tempo deveriam vender mais.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h5-lojas-com-mais-promocoes-consecutivas-deveriam-vender-mais"><strong>H5.</strong> Lojas com mais promoções consecutivas deveriam vender mais.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h6-lojas-abertas-durante-o-feriado-de-natal-deveriam-vender-em-media-mais-que-os-demais-feriados"><strong>H6.</strong> Lojas abertas durante o feriado de Natal deveriam vender em média mais que os demais feriados.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h7-lojas-deveriam-vender-mais-ao-longo-dos-anos"><strong>H7.</strong> Lojas deveriam vender mais ao longo dos anos.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h8-lojas-deveriam-vender-mais-no-segundo-semestre-do-ano"><strong>H8.</strong> Lojas deveriam vender mais no segundo semestre do ano.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h10-lojas-deveriam-vender-mais-na-media-depois-do-dia-10-de-cada-mes"><strong>H10.</strong> Lojas deveriam vender mais na média depois do dia 10 de cada mês.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h11-lojas-deveriam-vender-menos-aos-finais-de-semana"><strong>H11.</strong> Lojas deveriam vender menos aos finais de semana.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h12-lojas-deveriam-vender-em-media-menos-durante-os-feriados-escolares"><strong>H12.</strong> Lojas deveriam vender em média menos durante os feriados escolares.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tabela-de-relevancia">Tabela de Relevância</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-multivariada">7.3. Analise Multivariada</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variaveis-numericas">7.3.1 Variaveis Numéricas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">7.3.2 Variaveis Categóricas</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">8. Data Preparation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rescaling">8.1 Rescaling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transformation">8.2 Transformation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#encoding">8.2.1 Encoding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#response-variable-transformation">8.2.2 Response Variable Transformation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nature-transformation">8.2.3 Nature Transformation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection">9. Feature Selection</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#split-dataframe-into-training-and-test-dataset">9.1 Split dataframe into training and test dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-as-feature-selector">9.2. RFE as Feature Selector</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-feature-selection">9.3 Manual Feature Selection</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#machine-learning-modeling">10. Machine Learning modeling</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#avarage-model">10.1 Avarage Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-model">10.2. Linear Regression Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-regularized-model-lasso">10.3. Linear Regression Regularized Model - Lasso</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest-regressor">10.4. Random Forest Regressor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost-regressor">10.5. XGBoost Regressor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gradient-boosting">10.6 Gradient Boosting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compare-model-s-performance">10.6 Compare Model’s Performance</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#hyperparameter-tuning">11. Hyperparameter Tuning</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#determinando-o-tamanho-da-amostra">11.1.1 Determinando o Tamanho da Amostra</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hyperparameter-tuning-com-bayesiansearchcv">11.1.2 Hyperparameter Tuning com BayesianSearchCV</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parametros">11.1.3 Parâmetros</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-final">11.3. Modelo Final</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#performance">12. Performance</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bussines-performance">12.1 Bussines Performance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#erro-percentual-medio-de-cada-loja">12.1.1 Erro percentual medio de cada loja</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distribuicao-e-analise-de-outiler-no-erro-do-modelo">12.1.2 Distribuição e Analise de Outiler no erro do modelo</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#total-performance">12.2 Total Performance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#machine-learning-performance">12.3 Machine Learning Performance</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#deploy">13. Deploy</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rossmann-class">13.1 Rossmann Class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#api-handler">13.2 API HANDLER</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#api-tester">13.3 API Tester</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusao">14. Conclusão</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#proximos-passos">15. Próximos Passos</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Matheus R. Oliveira
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>